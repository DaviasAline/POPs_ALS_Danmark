---
title: "Aline's work"
format: html
editor: visual
toc: true
toc_depth: 4
theme:
  light: flatly
  dark: darkly
toc-location: left
---

```{r}
#| message: false
#| warning: false
#| include: false
source("~/Documents/POP_ALS_2025_02_03/1_codes/2.7_analyses_proteomic_ALS_survival.R")
```

# Danish data description

## ALS survival

```{r}
#| echo: false
#| message: false
#| warning: false
bdd_danish |> 
  filter(als == 1) |>
  ggplot() +
  aes(x = follow_up_death) +
  geom_density(fill = "lightgray") +
  theme_bw() +
  stat_overlay_normal_density(color = "red", linetype = "dashed") +
  theme(axis.title = element_blank())
descrip_num(data = bdd_danish, vars = "follow_up_death") |>
  flextable() |>
  flextable::font(fontname = "Calibri", part = "all") |> 
  fontsize(size = 10, part = "all") |>
  padding(padding.top = 0, padding.bottom = 0, part = "all") |>
  set_table_properties(align = "left")
```

## Metadata

Not imputed for missing data

```{r}
#| echo: false
#| message: false
#| warning: false
results_descriptive$danish$covar_danish |>
  as_flex_table() |>
  flextable::font(fontname = "Calibri", part = "all") |> 
  fontsize(size = 10, part = "all") |>
  padding(padding.top = 0, padding.bottom = 0, part = "all") |>
  set_table_properties(align = "left")
```

### Multiple cholesterol variables

```{r, fig.height=5}
#| echo: false
#| message: false
#| warning: false
boxplot(data = bdd_danish, vars = c("fS_Kol", "cholesterol"))
descrip_num(data = bdd_danish, vars = c("fS_Kol", "cholesterol")) |>
  flextable() |>
  flextable::font(fontname = "Calibri", part = "all") |> 
  fontsize(size = 10, part = "all") |>
  padding(padding.top = 0, padding.bottom = 0, part = "all") |>
  set_table_properties(align = "left")
cor.test(bdd_danish$fS_Kol, bdd_danish$cholesterol)
```

### Timing between baseline, ALS diagnosis and death

```{r}
#| echo: false
#| message: false
#| warning: false
timing <- bdd |> 
  filter(study == "Danish") |>
  filter(als == 1) |>
  select(baseline_age, diagnosis_age, death_age, 
         time_baseline_diagnosis, time_baseline_death, time_diagnosis_death)

timing |> 
  tbl_summary() |>
  as_flex_table() |>
  flextable::font(fontname = "Calibri", part = "all") |> 
  fontsize(size = 10, part = "all") |>
  padding(padding.top = 0, padding.bottom = 0, part = "all") |>
  set_table_properties(align = "left")

descrip_num(data = timing, vars = colnames(timing))   |>
  flextable() |>
  flextable::font(fontname = "Calibri", part = "all") |> 
  fontsize(size = 10, part = "all") |>
  padding(padding.top = 0, padding.bottom = 0, part = "all") |>
  set_table_properties(align = "left")
rm(timing)
```

## POPs

### Distribution tables

```{r}
#| echo: false
#| message: false
#| warning: false
results_descriptive$danish$POPs_table_danish |>
  flextable() |>
  flextable::font(fontname = "Calibri", part = "all") |> 
  fontsize(size = 10, part = "all") |>
  padding(padding.top = 0, padding.bottom = 0, part = "all") |>
  set_table_properties(align = "left")
```

### Comparison of distribution cases/controls

```{r}
#| echo: false
#| message: false
#| warning: false
results_descriptive$danish$POPs_table_danish_by_als|>
  as_flex_table() |>
  flextable::font(fontname = "Calibri", part = "all") |> 
  fontsize(size = 10, part = "all") |>
  padding(padding.top = 0, padding.bottom = 0, part = "all") |>
  set_table_properties(align = "left")
```

### Heatmap of correlation

```{r fig.height=11, fig.width=11}
#| echo: false
#| message: false
#| warning: false
corrplot(results_descriptive$danish$POPs_heatmap_danish, 
         method = 'color', 
         type = "lower", 
         tl.col = 'black', 
         tl.srt = 45, 
         addCoef.col = "black",
         number.cex = 0.8,
         number.digits = 1,
         tl.cex = 1,
         col = rev(COL2(diverging = "RdYlBu")))
```

### Boxplots

```{r, fig.width=10, fig.height=10}
#| echo: false
#| message: false
#| warning: false
# descrip_expo_danish
results_descriptive$danish$POPs_boxplot_danish_by_als
```

```{r}
#| echo: false
#| message: false
#| warning: false
results_descriptive$danish$POPs_group_boxplot_danish_by_als
```

POPs distribution depending on alive/deceased status at the end of the follow-up (among cases)

```{r}
#| echo: false
#| message: false
#| warning: false
results_descriptive$danish$POPs_group_boxplot_danish_by_death
```

### Detailed distribution

#### Summed

```{r}
#| echo: false
#| message: false
#| warning: false
densityplot(data = bdd_danish, vars = POPs_group)
boxplot(data = bdd_danish, vars = POPs_group)
heatmap_cor(cormat = bdd_danish[POPs_group], decimal = 1)
```

#### PCBs

```{r}
#| echo: false
#| message: false
#| warning: false
PCBs <- bdd_danish |> select(all_of(POPs)) |> select(contains("PCB")) |> colnames()
densityplot(data = bdd_danish, vars = PCBs[1:9])
```

```{r, fig.height=3.33}
#| echo: false
#| message: false
#| warning: false
densityplot(data = bdd_danish, vars = PCBs[10:13])
```

```{r}
#| echo: false
#| message: false
#| warning: false
boxplot(data = bdd_danish, vars = PCBs[1:10])
```

```{r, fig.height=2}
#| echo: false
#| message: false
#| warning: false
boxplot(data = bdd_danish, vars = PCBs[11:13])
```

```{r}
#| echo: false
#| message: false
#| warning: false
heatmap_cor(cormat = bdd_danish[PCBs], decimal = 1)
rm(PCBs)
```

#### OCPs

```{r}
#| echo: false
#| message: false
#| warning: false
OCPs <- bdd_danish |> select(all_of(POPs)) |> select(contains("OCP")) |> colnames()
densityplot(data = bdd_danish, vars = OCPs)
boxplot(data = bdd_danish, vars = OCPs)
heatmap_cor(cormat = bdd_danish[OCPs], decimal = 1)
```

#### PBDEs

```{r,  fig.width=7, fig.height=3}
#| echo: false
#| message: false
#| warning: false
PBDEs <- bdd_danish |> select(all_of(POPs)) |> select(contains("PBDE")) |> colnames()
densityplot(data = bdd_danish, vars = PBDEs)
boxplot(data = bdd_danish, vars = PBDEs)
```

```{r,  fig.width=7, fig.height=4}
#| echo: false
#| message: false
#| warning: false
heatmap_cor(cormat = bdd_danish[PBDEs], decimal = 1)
```

## Fatty acids

### Distribution tables

```{r}
#| echo: false
#| message: false
#| warning: false
results_descriptive$danish$fattyacids_table_danish|>
  flextable() |>
  flextable::font(fontname = "Calibri", part = "all") |> 
  fontsize(size = 10, part = "all") |>
  padding(padding.top = 0, padding.bottom = 0, part = "all") |>
  set_table_properties(align = "left")
```

### Comparison of distribution cases/controls

```{r}
#| echo: false
#| message: false
#| warning: false
results_descriptive$danish$fattyacids_table_danish_by_als |>
  as_flex_table() |>
  flextable::font(fontname = "Calibri", part = "all") |> 
  fontsize(size = 10, part = "all") |>
  padding(padding.top = 0, padding.bottom = 0, part = "all") |>
  set_table_properties(align = "left")
```

### Heatmap of correlation

```{r, fig.height=12, fig.width=12}
#| echo: false
#| message: false
#| warning: false
corrplot(results_descriptive$danish$fattyacids_heatmap_danish, 
         method = 'color', 
         type = "lower", 
         tl.col = 'black', 
         tl.srt = 45, 
         addCoef.col = "black",
         number.cex = 0.8,
         number.digits = 1,
         tl.cex = 1,
         col = rev(COL2(diverging = "RdYlBu")))
```

### Boxplots

```{r, fig.height=10, fig.width=10}
#| echo: false
#| message: false
#| warning: false
results_descriptive$danish$fattyacids_boxplot_danish_by_als
```

### Detailed distribution

#### Density plots

```{r, fig.height=10, fig.width=10}
#| echo: false
#| message: false
#| warning: false
bdd_danish |> 
  select(sample, all_of(fattyacids_tot)) |>
  pivot_longer(cols = -sample, names_to = "fattyacids", values_to = "values") |>
  mutate(fattyacids = fct_recode(fattyacids, !!!fattyacids_tot_labels)) |>
  ggplot() +
  aes(x = values) +
  geom_density(fill = "#112446") +
  theme_minimal() +
  facet_wrap(~fattyacids, scales = "free", ncol = 4)
```

## Heatmap POPs/Fatty acids

```{r, fig.width=12, fig.height=12}
#| echo: false
#| message: false
#| warning: false
results_descriptive$danish$POPs_fattyacids_heatmap_danish
```

## Proteomic

### Distribution table

```{r}
#| echo: false
#| message: false
#| warning: false
results_descriptive$danish$proteomic_table_danish  |>
  flextable() |>
  flextable::font(fontname = "Calibri", part = "all") |> 
  fontsize(size = 10, part = "all") |>
  padding(padding.top = 0, padding.bottom = 0, part = "all") |>
  set_table_properties(align = "left")
```

### Comparison of distribution cases/controls

```{r}
#| eval: false
#| message: false
#| warning: false
#| include: false
results_descriptive$danish$proteomic_table_danish_by_als|>
  as_flex_table() |>
  flextable::font(fontname = "Calibri", part = "all") |> 
  fontsize(size = 10, part = "all") |>
  padding(padding.top = 0, padding.bottom = 0, part = "all") |>
  set_table_properties(align = "left")
```

### Heatmap of correlation

All

```{r fig.height=11, fig.width=11}
#| eval: false
#| message: false
#| warning: false
#| include: false
corrplot(results_descriptive$danish$proteomic_heatmap_danish, 
         method = 'color', 
         type = "lower", 
         tl.col = 'black',
         order = "hclust",         # regroupement des variables selon niveau de cor
         tl.srt = 45, 
         # addCoef.col = "black",
         # number.cex = 0.8,
         # number.digits = 1,
         tl.cex = 0.4,             # taille police des variables
         col = rev(COL2(diverging = "RdYlBu")))
```

```{r fig.height=11, fig.width=11}
#| echo: false
#| message: false
#| warning: false

vars <- colnames(results_descriptive$danish$proteomic_heatmap_danish)

col_labels <- ifelse(grepl("proteomic_metabolism_", vars), "#1b9e77",  # vert
                     ifelse(grepl("proteomic_immun_res_", vars), "#d95f02",    # orange
                            ifelse(grepl("proteomic_neuro_explo_", vars), "#7570b3",  # violet
                                   "black")))

corr_order <- corrMatOrder(results_descriptive$danish$proteomic_heatmap_danish, order = "hclust", hclust.method = "complete")
col_labels_ordered <- col_labels[corr_order]

corrplot(results_descriptive$danish$proteomic_heatmap_danish,
         method = "color",
         type = "lower",
         order = "hclust",
         hclust.method = "complete",
         # order = "original",
         tl.col = col_labels_ordered,  # couleurs align√©es √† l‚Äôordre
         tl.srt = 45,
         tl.cex = 0.4,
         col = rev(COL2(diverging = "RdYlBu")))

rm(vars, col_labels, corr_order, col_labels_ordered)
```

Neuro explo

```{r fig.height=11, fig.width=11}
#| echo: false
#| message: false
#| warning: false

corrplot(results_descriptive$danish$proteomic_heatmap_danish_neuro_explo, 
         method = 'color', 
         type = "lower", 
         tl.col = 'black',
         order = "hclust",         # regroupement des variables selon niveau de cor
         tl.srt = 45, 
         # addCoef.col = "black",
         # number.cex = 0.8,
         # number.digits = 1,
         tl.cex = 0.4,             # taille police des variables
         col = rev(COL2(diverging = "RdYlBu")))
```

Immune response

```{r fig.height=11, fig.width=11}
#| echo: false
#| message: false
#| warning: false

corrplot(results_descriptive$danish$proteomic_heatmap_danish_immun_res, 
         method = 'color', 
         type = "lower", 
         tl.col = 'black',
         order = "hclust",         # regroupement des variables selon niveau de cor
         tl.srt = 45, 
         # addCoef.col = "black",
         # number.cex = 0.8,
         # number.digits = 1,
         tl.cex = 0.4,             # taille police des variables
         col = rev(COL2(diverging = "RdYlBu")))
```

Metabolism

```{r fig.height=11, fig.width=11}
#| echo: false
#| message: false
#| warning: false

corrplot(results_descriptive$danish$proteomic_heatmap_danish_metabolism, 
         method = 'color', 
         type = "lower", 
         tl.col = 'black',
         order = "hclust",         # regroupement des variables selon niveau de cor
         tl.srt = 45, 
         # addCoef.col = "black",
         # number.cex = 0.8,
         # number.digits = 1,
         tl.cex = 0.4,             # taille police des variables
         col = rev(COL2(diverging = "RdYlBu")))

```

### Boxplots

```{r, fig.width=10, fig.height=30}
#| echo: false
#| message: false
#| warning: false
results_descriptive$danish$proteomic_boxplot_danish
```

Comparison between cases and controls

```{r, fig.width=10, fig.height=30}
#| echo: false
#| message: false
#| warning: false
results_descriptive$danish$proteomic_boxplot_danish_by_als
```

Comparison between alive/deceased status at the end of the follow-up (among cases)

```{r, fig.width=10, fig.height=30}
#| echo: false
#| message: false
#| warning: false
results_descriptive$danish$proteomic_boxplot_danish_by_death
```

### NEFL 
```{r}
#| echo: false
#| message: false
#| warning: false
results_descriptive$danish$figure_NEFL
```


## EVs

### Distribution tables

```{r}
#| echo: false
#| message: false
#| warning: false
results_descriptive$danish$EVs_table_danish |>
  flextable() |>
  flextable::font(fontname = "Calibri", part = "all") |> 
  fontsize(size = 10, part = "all") |>
  padding(padding.top = 0, padding.bottom = 0, part = "all") |>
  set_table_properties(align = "left")
```

### Comparison of distribution cases/controls

```{r}
#| echo: false
#| message: false
#| warning: false
results_descriptive$danish$EVs_table_danish_by_als |>
  as_flex_table() |>
  flextable::font(fontname = "Calibri", part = "all") |> 
  fontsize(size = 10, part = "all") |>
  padding(padding.top = 0, padding.bottom = 0, part = "all") |>
  set_table_properties(align = "left")
```

### Heatmap of correlation

```{r, fig.height=12, fig.width=12}
#| echo: false
#| message: false
#| warning: false
corrplot(results_descriptive$danish$EVs_heatmap_danish, 
         method = 'color', 
         type = "lower", 
         tl.col = 'black', 
         tl.srt = 45, 
         addCoef.col = "black",
         number.cex = 0.8,
         number.digits = 1,
         tl.cex = 1,
         col = rev(COL2(diverging = "RdYlBu")))

```

### Boxplots

```{r, fig.height=10, fig.width=10}
#| echo: false
#| message: false
#| warning: false
results_descriptive$danish$EVs_boxplot_danish
```

Comparison between cases and controls

```{r, fig.height=10, fig.width=10}
#| echo: false
#| message: false
#| warning: false
results_descriptive$danish$EVs_boxplot_danish_by_als
```

Comparison between alive/deceased status at the end of the follow-up (among cases)

```{r, fig.width=10, fig.height=10}
#| echo: false
#| message: false
#| warning: false
results_descriptive$danish$EVs_boxplot_danish_by_death
```

# Finnish data description

## ALS survival

```{r}
#| echo: false
#| message: false
#| warning: false
bdd_finnish |> 
  filter(als == 1) |>
  select(follow_up_death, status_death, study) |>
  tbl_summary(by = "study") |>
  as_flex_table() |>
  flextable::font(fontname = "Calibri", part = "all") |> 
  fontsize(size = 10, part = "all") |>
  padding(padding.top = 0, padding.bottom = 0, part = "all") |>
  set_table_properties(align = "left")

densityplot(data = bdd_finnish, vars = "follow_up_death") 
descrip_num(data = bdd_finnish, vars = "follow_up_death") |>
  flextable() |>
  flextable::font(fontname = "Calibri", part = "all") |> 
  fontsize(size = 10, part = "all") |>
  padding(padding.top = 0, padding.bottom = 0, part = "all") |>
  set_table_properties(align = "left")
```

## Metadata

```{r}
#| echo: false
#| message: false
#| warning: false
results_descriptive$finnish$covar_finnish |>
  as_flex_table() |>
  flextable::font(fontname = "Calibri", part = "all") |> 
  fontsize(size = 10, part = "all") |>
  padding(padding.top = 0, padding.bottom = 0, part = "all") |>
  set_table_properties(align = "left")
```

## POPs

### Distribution tables

```{r}
#| echo: false
#| message: false
#| warning: false
results_descriptive$finnish$POPs_table_finnish |>
  flextable() |>
  flextable::font(fontname = "Calibri", part = "all") |> 
  fontsize(size = 10, part = "all") |>
  padding(padding.top = 0, padding.bottom = 0, part = "all") |>
  set_table_properties(align = "left")
```

### Comparison of distribution cases/controls

```{r}
#| echo: false
#| message: false
#| warning: false
results_descriptive$finnish$POPs_table_finnish_by_als |>
  as_flex_table() |>
  flextable::font(fontname = "Calibri", part = "all") |> 
  fontsize(size = 10, part = "all") |>
  padding(padding.top = 0, padding.bottom = 0, part = "all") |>
  set_table_properties(align = "left")
```

### Heatmap of correlation

```{r fig.height=11, fig.width=11}
#| echo: false
#| message: false
#| warning: false
corrplot(results_descriptive$finnish$POPs_heatmap_finnish, 
         method = 'color', 
         type = "lower", 
         tl.col = 'black', 
         tl.srt = 45, 
         addCoef.col = "black",
         number.cex = 0.8,
         number.digits = 1,
         tl.cex = 1,
         col = rev(COL2(diverging = "RdYlBu")))
```

### Boxplots

```{r, fig.width=10, fig.height=10}
#| echo: false
#| message: false
#| warning: false
# results_descriptive$finnish$POPs_boxplot_finnish
results_descriptive$finnish$POPs_boxplot_finnish_by_als
```

### Detailed distribution

#### Summed

```{r}
#| echo: false
#| message: false
#| warning: false
densityplot(data = bdd_finnish, vars = POPs_group)
boxplot(data = bdd_finnish, vars = POPs_group)
heatmap_cor(cormat = bdd_finnish[POPs_group], decimal = 1)
```

#### PCBs

```{r}
#| echo: false
#| message: false
#| warning: false
PCBs <- bdd_finnish |> select(all_of(POPs_finnish)) |> select(contains("PCB")) |> colnames()
densityplot(data = bdd_finnish, vars = PCBs[1:9])
```

```{r, fig.height=3.33}
#| echo: false
#| message: false
#| warning: false
densityplot(data = bdd_finnish, vars = PCBs[10:13])
```

```{r}
#| echo: false
#| message: false
#| warning: false
boxplot(data = bdd_finnish, vars = PCBs[1:10])
```

```{r, fig.height=2}
#| echo: false
#| message: false
#| warning: false
boxplot(data = bdd_finnish, vars = PCBs[11:13])
```

```{r}
#| echo: false
#| message: false
#| warning: false
heatmap_cor(cormat = bdd_finnish[PCBs], decimal = 1)
rm(PCBs)
```

#### OCPs

```{r}
#| echo: false
#| message: false
#| warning: false
OCPs <- bdd_finnish |> select(all_of(POPs_finnish)) |> select(contains("OCP")) |> colnames()
densityplot(data = bdd_finnish, vars = OCPs)
boxplot(data = bdd_finnish, vars = OCPs)
# heatmap_cor(cormat = bdd_finnish[OCPs], decimal = 1)
```

#### PBDEs

```{r,  fig.width=7, fig.height=3}
#| echo: false
#| message: false
#| warning: false
PBDEs <- bdd_finnish |> select(all_of(POPs_finnish)) |> select(contains("PBDE")) |> colnames()
densityplot(data = bdd_finnish, vars = PBDEs)
boxplot(data = bdd_finnish, vars = PBDEs)
```

```{r,  fig.width=7, fig.height=4}
#| echo: false
#| message: false
#| warning: false
heatmap_cor(cormat = bdd_finnish[PBDEs], decimal = 1)
```

## Fatty acids

### Distribution tables

```{r}
#| echo: false
#| message: false
#| warning: false
results_descriptive$finnish$fattyacids_table_finnish |>
  flextable() |>
  flextable::font(fontname = "Calibri", part = "all") |> 
  fontsize(size = 10, part = "all") |>
  padding(padding.top = 0, padding.bottom = 0, part = "all") |>
  set_table_properties(align = "left")
```

### Comparison of distribution cases/controls

```{r}
#| echo: false
#| message: false
#| warning: false
results_descriptive$finnish$fattyacids_table_finnish_by_als |>
  as_flex_table() |>
  flextable::font(fontname = "Calibri", part = "all") |> 
  fontsize(size = 10, part = "all") |>
  padding(padding.top = 0, padding.bottom = 0, part = "all") |>
  set_table_properties(align = "left")
```

### Heatmap of correlation

```{r, fig.height=12, fig.width=12}
#| echo: false
#| message: false
#| warning: false
corrplot(results_descriptive$finnish$fattyacids_heatmap_finnish, 
         method = 'color', 
         type = "lower", 
         tl.col = 'black', 
         tl.srt = 45, 
         addCoef.col = "black",
         number.cex = 0.8,
         number.digits = 1,
         tl.cex = 1,
         col = rev(COL2(diverging = "RdYlBu")))
```

### Boxplots

```{r, fig.height=10, fig.width=10}
#| echo: false
#| message: false
#| warning: false
results_descriptive$finnish$fattyacids_boxplot_finnish_by_als
```

### Detailed distribution

```{r, fig.height=10, fig.width=10}
#| echo: false
#| message: false
#| warning: false
bdd_finnish |> 
  select(sample, all_of(fattyacids_tot)) |>
  pivot_longer(cols = -sample, names_to = "fattyacids", values_to = "values") |>
    mutate(fattyacids = fct_recode(fattyacids, !!!fattyacids_tot_labels)) |>
  ggplot() +
  aes(x = "", y = values) +
  geom_boxplot(shape = "circle", fill = "#112446") +
  coord_flip() +
  theme_bw() +
  theme(axis.title = element_blank()) +
  facet_wrap(~fattyacids, scales = "free", ncol = 3L, nrow = 14L)
```

## Heatmap POPs/Fatty acids

```{r, fig.width=12, fig.height=12}
#| echo: false
#| message: false
#| warning: false
results_descriptive$finnish$POPs_fattyacids_heatmap_finnish
```

## Multiple cholesterol variables issue

Why do we have 3 cholesterol variables in the finnish data ?

```{r, fig.height=4}
#| echo: false
#| message: false
#| warning: false
boxplot(data = bdd_finnish, vars = c("fS_Kol", "chol", "cholesterol"))
descrip_num(data = bdd_finnish, vars = c("fS_Kol", "chol", "cholesterol")) |>
  flextable() |>
  flextable::font(fontname = "Calibri", part = "all") |> 
  fontsize(size = 10, part = "all") |>
  padding(padding.top = 0, padding.bottom = 0, part = "all") 
heatmap_cholesterol <- bdd_finnish |> select("fS_Kol", "chol", "cholesterol")
heatmap_cholesterol <- cor(heatmap_cholesterol, 
                    use = "pairwise.complete.obs", 
                    method = "pearson")

corrplot(heatmap_cholesterol, 
         method = 'color', 
         type = "lower", 
         tl.col = 'black', 
         tl.srt = 45, 
         addCoef.col = "black",
         number.cex = 0.8,
         number.digits = 1,
         tl.cex = 1,
         col = rev(COL2(diverging = "RdYlBu")))

```

## Timing between baseline, ALS diagnosis and death

### FMC

```{r}
#| echo: false
#| message: false
#| warning: false
timing <- bdd |> 
  filter(study == "FMC") |>
  filter(als == 1) |>
  select(baseline_age, diagnosis_age, death_age) |>
  mutate(time_baseline_diagnosis = diagnosis_age - baseline_age, 
         time_baseline_death = death_age - baseline_age, 
         time_diagnosis_death = death_age - diagnosis_age) 

timing |> 
  tbl_summary() |>
  as_flex_table() |>
  flextable::font(fontname = "Calibri", part = "all") |> 
  fontsize(size = 10, part = "all") |>
  padding(padding.top = 0, padding.bottom = 0, part = "all") |>
  set_table_properties(align = "left")

descrip_num(data = timing, vars = colnames(timing)) |>
  flextable() |>
  flextable::font(fontname = "Calibri", part = "all") |> 
  fontsize(size = 10, part = "all") |>
  padding(padding.top = 0, padding.bottom = 0, part = "all") |>
  set_table_properties(align = "left")
rm(timing)
```

### FMCF

```{r}
#| echo: false
#| message: false
#| warning: false
timing <- bdd |> 
  filter(study == "FMCF") |>
  filter(als == 1) |>
  select(baseline_age, diagnosis_age, death_age, 
         time_baseline_diagnosis, time_baseline_death, time_diagnosis_death)

timing |> 
  tbl_summary() |>
  as_flex_table() |>
  flextable::font(fontname = "Calibri", part = "all") |> 
  fontsize(size = 10, part = "all") |>
  padding(padding.top = 0, padding.bottom = 0, part = "all") |>
   set_table_properties(align = "left")|>
  set_table_properties(align = "left")

descrip_num(data = timing, vars = colnames(timing)) |>
  flextable() |>
  flextable::font(fontname = "Calibri", part = "all") |> 
  fontsize(size = 10, part = "all") |>
  padding(padding.top = 0, padding.bottom = 0, part = "all") |>
  set_table_properties(align = "left")
rm(timing)
```

### MFH

```{r}
#| echo: false
#| message: false
#| warning: false
timing <- bdd |> 
  filter(study == "MFH") |>
  filter(als == 1) |>
  select(baseline_age, diagnosis_age, death_age, 
         time_baseline_diagnosis, time_baseline_death, time_diagnosis_death)

timing |> 
  tbl_summary() |>
  as_flex_table() |>
  flextable::font(fontname = "Calibri", part = "all") |> 
  fontsize(size = 10, part = "all") |>
  padding(padding.top = 0, padding.bottom = 0, part = "all") |>
  set_table_properties(align = "left")

descrip_num(data = timing, vars = colnames(timing)) |>
  flextable() |>
  flextable::font(fontname = "Calibri", part = "all") |> 
  fontsize(size = 10, part = "all") |>
  padding(padding.top = 0, padding.bottom = 0, part = "all") |>
  set_table_properties(align = "left")
rm(timing)
```

# Comparison danish/finnish data

## On the total population

### Metadata

```{r}
#| echo: false
#| message: false
#| warning: false
results_descriptive$comp$covar_comp |>
  as_flex_table() |>
  flextable::font(fontname = "Calibri", part = "all") |> 
  fontsize(size = 10, part = "all") |>
  padding(padding.top = 0, padding.bottom = 0, part = "all") |>
  set_table_properties(align = "left")
```

### POPs

```{r, fig.width=10, fig.height=10}
#| echo: false
#| message: false
#| warning: false
results_descriptive$comp$POPs_table_comp |>
  as_flex_table() |>
  flextable::font(fontname = "Calibri", part = "all") |> 
  fontsize(size = 10, part = "all") |>
  padding(padding.top = 0, padding.bottom = 0, part = "all") |>
  set_table_properties(align = "left")
results_descriptive$comp$POPs_boxplot_comp
```

### Fatty acids

```{r, fig.height=12, fig.width=12}
#| echo: false
#| message: false
#| warning: false
results_descriptive$comp$fattyacids_table_comp |>
  as_flex_table() |>
  flextable::font(fontname = "Calibri", part = "all") |> 
  fontsize(size = 10, part = "all") |>
  padding(padding.top = 0, padding.bottom = 0, part = "all") |>
  set_table_properties(align = "left")
results_descriptive$comp$fattyacids_boxplot_comp 
```

## Among cases

(for ALS survival analyses) \#### Metadata

```{r}
#| echo: false
#| message: false
#| warning: false
results_descriptive$comp$covar_comp_cases |>
  as_flex_table() |>
  flextable::font(fontname = "Calibri", part = "all") |> 
  fontsize(size = 10, part = "all") |>
  padding(padding.top = 0, padding.bottom = 0, part = "all") |>
  set_table_properties(align = "left")
```

### POPs

```{r}
#| echo: false
#| message: false
#| warning: false
results_descriptive$comp$POPs_table_comp_cases |>
  as_flex_table() |>
  flextable::font(fontname = "Calibri", part = "all") |> 
  fontsize(size = 10, part = "all") |>
  padding(padding.top = 0, padding.bottom = 0, part = "all") |>
  set_table_properties(align = "left")

results_descriptive$comp$POPs_boxplot_comp_cases
```

```{r, fig.width=12, fig.height=12}
#| echo: false
#| message: false
#| warning: false
#| paged-print: false
corrplot(results_descriptive$comp$POPs_heatmap_cases, 
         method = 'color', 
         type = "lower", 
         tl.col = 'black', 
         tl.srt = 45, 
         addCoef.col = "black",
         number.cex = 0.8,
         number.digits = 1,
         tl.cex = 1,
         col = rev(COL2(diverging = "RdYlBu")))
```


# POPs and ALS occurence

## Danish cohort

### Effects of subject characteristics on ALS occurence

```{r}
#| echo: false
#| message: false
#| warning: false
results_POPs_ALS_occurrence$main$covar |>
  as_flex_table() |>
  flextable::font(fontname = "Calibri", part = "all") |> 
  fontsize(size = 10, part = "all") |>
  padding(padding.top = 0, padding.bottom = 0, part = "all") |>
  set_table_properties(align = "left")
```

### Effects of POPs on ALS occurence

#### Quartile models

##### Main analysis

In the copollutant models, the pollutant of interest is quartile while the others are s() in a GAM model

```{r fig.height=9, fig.width=9}
#| echo: false
#| message: false
#| warning: false
results_POPs_ALS_occurrence$main$plot_quart
```

```{r}
#| echo: false
#| message: false
#| warning: false
extra_rows <- results_POPs_ALS_occurrence$main$results_quart |>
  distinct(variable) |> 
  mutate(
    quartiles = "Quartile 1",
    "OR_base" = '-', "95%CI_base" = '-', "p.value_base" = '', "p.value_heterogeneity_base" = '', "p.value_trend_base" = '',
    "OR_adjusted" = '-', "95%CI_adjusted" = '-', "p.value_adjusted" = '', , "p.value_heterogeneity_adjusted" = '', "p.value_trend_adjusted" = '',
    "OR_copollutant" = '-', "95%CI_copollutant" ='-', "p.value_copollutant" = '', , "p.value_heterogeneity_copollutant" = '', "p.value_trend_copollutant" = '')

table_S2 <- 
  results_POPs_ALS_occurrence$main$main_results |>
  select(-lower_CI, -upper_CI, - p.value_raw) |>
  filter(model %in% c('base_quart', 'adjusted_quart', 'copollutant_quart')) |>
  pivot_wider(
    names_from = model,  
    values_from = c(OR, `95%CI`, p.value, p.value_heterogeneity, p.value_trend)) |>
  select(variable, 
         quartiles = df,
         contains("base_quart"), 
         contains("adjusted_quart"), 
         contains("copollutant_quart")) 
colnames(table_S2) <- gsub('_quart', '', colnames(table_S2))

table_S2 <- table_S2 |>
  mutate_if(is.numeric, as.character) |>
  bind_rows(extra_rows) |>
  mutate(
    variable = gsub("OCP_", "", variable), 
    variable = fct_relevel(variable, "PCB_4", "PCB_DL", "PCB_NDL",  "HCB", "Œ£DDT", "Œ≤_HCH", "Œ£chlordane", "Œ£PBDE" ),
    variable = fct_recode(variable, 
                          "Most prevalent PCBs" = "PCB_4",
                          "Dioxin-like PCBs" = "PCB_DL",
                          "Non-dioxin-like PCBs" = "PCB_NDL",
                          "Œ≤-HCH" = "Œ≤_HCH")) |>
  arrange(variable, quartiles) |>
  group_by(variable) |>
  mutate(p.value_heterogeneity_base = ifelse(quartiles == 'Quartile 1', p.value_heterogeneity_base[quartiles == 'Quartile 2'], ''), 
         p.value_trend_base = ifelse(quartiles == 'Quartile 1', p.value_trend_base[quartiles == 'Quartile 2'], ''),
         p.value_heterogeneity_adjusted = ifelse(quartiles == 'Quartile 1', p.value_heterogeneity_adjusted[quartiles == 'Quartile 2'], ''), 
         p.value_trend_adjusted = ifelse(quartiles == 'Quartile 1', p.value_trend_adjusted[quartiles == 'Quartile 2'], ''), 
         p.value_heterogeneity_copollutant = ifelse(quartiles == 'Quartile 1', p.value_heterogeneity_copollutant[quartiles == 'Quartile 2'], ''), 
         p.value_trend_copollutant = ifelse(quartiles == 'Quartile 1', p.value_trend_copollutant[quartiles == 'Quartile 2'], '')) |>
  ungroup() |>
  rename('OR' = 'OR_base', '95% CI' = '95%CI_base', 'p-value' = 'p.value_base', 
         'Heterogeneity test' = 'p.value_heterogeneity_base', 'Trend test' = 'p.value_trend_base',
         'OR ' = 'OR_adjusted', '95% CI ' = '95%CI_adjusted', 'p-value ' = 'p.value_adjusted', 
         'Heterogeneity test ' = 'p.value_heterogeneity_adjusted', 'Trend test ' = 'p.value_trend_adjusted',
         ' OR ' = 'OR_copollutant', ' 95% CI ' = '95%CI_copollutant', ' p-value ' = 'p.value_copollutant',
         ' Heterogeneity test ' = 'p.value_heterogeneity_copollutant', ' Trend test ' = 'p.value_trend_copollutant')
table_S2 <- table_S2 |> flextable() |>
  add_footer_lines(
    "1POPs were summed as follows: Dioxin-like PCBs corresponds to PCBs 118 and 156; non-dioxin-like PCBs corresponds to PCBs 28, 52, 74, 99, 101, 138, 153, 170, 180, 183, 187; most prevalent PCBs corresponds to PCBs 118, 138, 153, 180; Œ£PBDE corresponds to PBDEs 47, 99, 153; Œ£DDT corresponds to p,p‚Äô-DDT and p,p‚Äô-DDE and finally Œ£chlordane corresponds to trans-nonanchlor and oxychlordane.
  2All models are matched for sex and age. Adjusted models further account for smoking, BMI, serum total cholesterol, marital status, and education. Co-pollutant models further include all chemicals, where a GAM is used in which the chemical of interest is categorized into quartiles, while the other pollutants are included as smooth terms.
  3Estimated risk of ALS when exposures to POP are at quartiles 2, 3, and 4, compared to quartile 1.
  4CI: Confidence interval.
  5Heterogeneity tests in outcome value across POP quartiles, matched on age and sex.
  6Trend tests using continuous variables whose values corresponded to the quartile specific median POP levels, matched on age and sex.
  7Heterogeneity tests in outcome value across POP quartiles, matched on age and sex, and adjusted for smoking, BMI, serum total cholesterol, marital status, and education.
  8Trend tests using continuous variables whose values corresponded to the quartile specific median POP levels, matched on age and sex, and adjusted for smoking, BMI, serum total cholesterol, marital status, and education.") |>
  add_header(
    "variable" = "Exposures", "quartiles" = "Quartiles",
    "OR" = "Base Model", "95% CI" = "Base Model", "p-value" = "Base Model", "Heterogeneity test" = 'Base Model', "Trend test" = 'Base Model',
    "OR " = "Adjusted Model", "95% CI " = "Adjusted Model", "p-value " = "Adjusted Model", "Heterogeneity test " = 'Adjusted Model', "Trend test " = 'Adjusted Model',
    " OR " = "Co-pollutant model", " 95% CI " = "Co-pollutant model", " p-value " = "Co-pollutant model", " Heterogeneity test " = 'Co-pollutant model', " Trend test " = 'Co-pollutant model') |>
  merge_h(part = "header") |>
  merge_v(j = "variable") |>
  theme_vanilla() |>
  bold(j = "variable", part = "body") |>
  align(align = "center", part = "all") |>
  align(j = "variable", align = "left", part = "all") |> 
  merge_at(j = "variable", part = "header") |>
  merge_at(j = "quartiles", part = "header") |>
  flextable::font(fontname = "Calibri", part = "all") |> 
  fontsize(size = 10, part = "all") |>
  padding(padding.top = 0, padding.bottom = 0, part = "all")|>
  set_table_properties(align = "left")

table_S2
rm(extra_rows, table_S2)
```

##### q-gcomp analysis

```{r}
#| echo: false
#| message: false
#| warning: false
results_POPs_ALS_occurrence$main$POPs_ALS_qgcomp_table_danish |>
  flextable() |>
  flextable::font(fontname = "Calibri", part = "all") |> 
  fontsize(size = 10, part = "all") |>
  padding(padding.top = 0, padding.bottom = 0, part = "all") |>
  set_table_properties(align = "left")
results_POPs_ALS_occurrence$main$POPs_ALS_qgcomp_figure_danish
```

##### Sensitivity analysis POPs not summed

```{r,  fig.height=15, fig.width=10}
#| echo: false
#| message: false
#| warning: false
results_POPs_ALS_occurrence$sensitivity_not_summed$plot_quart_sensi_not_summed
```

#### GAM models

Relationship between POPs exposure at baseline time and ALS occurrence estimated using a generalized additive model (gam) from the Danish Diet, Cancer and Health study cohort established between December 1993 and May 1997. The solid blue line represents the predicted ALS occurrence by POPs exposure given that all other covariates are at their respective means. The light blue represents the 95% confidence intervals. All models were adjusted for sex and age. Adjusted models further account for serum cholesterol, BMI, smoking status, marital status and education. The effective degrees of freedom (EDF) for the POPs smooth terms is a summary statistic of a gam that reflects the degree of nonlinearity (edf=1: linear, edf=2: quadratic, edf\>2: more complex than quadratic).

##### Main analyses

```{r, fig.height=3.5, fig.width=9}
#| echo: false
#| message: false
#| warning: false
wrap_plots(
  results_POPs_ALS_occurrence$main$plot_base_gam$PCB_DL, 
  results_POPs_ALS_occurrence$main$plot_adjusted_gam$PCB_DL, 
  results_POPs_ALS_occurrence$main$plot_copollutant_gam$PCB_DL, 
  nrow = 1)
wrap_plots(
  results_POPs_ALS_occurrence$main$plot_base_gam$PCB_NDL, 
  results_POPs_ALS_occurrence$main$plot_adjusted_gam$PCB_NDL, 
  results_POPs_ALS_occurrence$main$plot_copollutant_gam$PCB_NDL, 
  nrow = 1)
wrap_plots(
  results_POPs_ALS_occurrence$main$plot_base_gam$PCB_4, 
  results_POPs_ALS_occurrence$main$plot_adjusted_gam$PCB_4,  
  wrap_elements(grid::nullGrob()),
  nrow = 1)
wrap_plots(
  results_POPs_ALS_occurrence$main$plot_base_gam$OCP_HCB, 
  results_POPs_ALS_occurrence$main$plot_adjusted_gam$OCP_HCB, 
  results_POPs_ALS_occurrence$main$plot_copollutant_gam$OCP_HCB, 
  nrow = 1)
wrap_plots(
  results_POPs_ALS_occurrence$main$plot_base_gam$Œ£DDT, 
  results_POPs_ALS_occurrence$main$plot_adjusted_gam$Œ£DDT, 
  results_POPs_ALS_occurrence$main$plot_copollutant_gam$Œ£DDT, 
  nrow = 1)
wrap_plots(
  results_POPs_ALS_occurrence$main$plot_base_gam$OCP_Œ≤_HCH, 
  results_POPs_ALS_occurrence$main$plot_adjusted_gam$OCP_Œ≤_HCH, 
  results_POPs_ALS_occurrence$main$plot_copollutant_gam$OCP_Œ≤_HCH, 
  nrow = 1)
wrap_plots(
  results_POPs_ALS_occurrence$main$plot_base_gam$Œ£chlordane, 
  results_POPs_ALS_occurrence$main$plot_adjusted_gam$Œ£chlordane, 
  results_POPs_ALS_occurrence$main$plot_copollutant_gam$Œ£chlordane, 
  nrow = 1)
wrap_plots(
  results_POPs_ALS_occurrence$main$plot_base_gam$Œ£PBDE, 
  results_POPs_ALS_occurrence$main$plot_adjusted_gam$Œ£PBDE, 
  results_POPs_ALS_occurrence$main$plot_copollutant_gam$Œ£PBDE, 
  nrow = 1)
```

##### Sensitivity analysis POPs not summed

```{r, fig.height=6, fig.width=15}
#| column: screen-inset-right
#| echo: false
#| message: false
#| warning: false
wrap_plots(results_POPs_ALS_occurrence$sensitivity_not_summed$plot_adjusted_gam_not_summed[1:8], ncol = 4)
wrap_plots(results_POPs_ALS_occurrence$sensitivity_not_summed$plot_adjusted_gam_not_summed[9:16], ncol = 4)
wrap_plots(results_POPs_ALS_occurrence$sensitivity_not_summed$plot_adjusted_gam_not_summed[17:22], ncol = 4)
```

## Metanalysis (quartiles)

```{r fig.height=9, fig.width=9}
#| echo: false
#| message: false
#| warning: false
results_POPs_ALS_occurrence$metanalysis$plot_metanalysis_quart
```

```{r}
#| echo: false
#| message: false
#| warning: false
extra_rows <- results_POPs_ALS_occurrence$metanalysis$metanalysis_quart |>
  distinct(explanatory) |> 
  mutate(
    term = "Quartile 1",
      "OR_base" = '-', "95%CI_base" = '-', "p-value_base" = '', "p-value_heterogeneity_base" = "", 
      "OR_adjusted" = '-', "95%CI_adjusted" = '-', "p-value_adjusted" = '', "p-value_heterogeneity_adjusted" = "", 
    "OR_copollutant" = '-', "95%CI_copollutant" = '-', "p-value_copollutant" = '', "p-value_heterogeneity_copollutant" = "")
    

table_S4 <- results_POPs_ALS_occurrence$metanalysis$metanalysis_quart |>
  select(model, explanatory, term, OR, `95%CI`, "p-value", 'p-value_heterogeneity') |>
  pivot_wider(
    names_from = model,  
    values_from = c("OR", "95%CI", "p-value", 'p-value_heterogeneity')) |>
  bind_rows(extra_rows) |>
  select(Exposures = explanatory, Quartiles = term,
         contains("base"), 
         contains("adjusted"), 
         contains("copollutant")) |>
  mutate(
    Exposures = gsub("OCP_", "", Exposures), 
    Exposures = fct_relevel(Exposures, "PCB_4", "PCB_DL", "PCB_NDL", "HCB", "Œ£DDT", "Œ≤_HCH", "Œ£chlordane"),
    Exposures = fct_recode(Exposures, 
                          "Most prevalent PCBs" = "PCB_4",
                          "Dioxin-like PCBs" = "PCB_DL",
                          "Non-dioxin-like PCBs" = "PCB_NDL",
                          "Œ≤-HCH" = "Œ≤_HCH")) |>
  arrange(Exposures, Quartiles) 

table_S4 <- table_S4 |> 
  rename('OR' = 'OR_base', '95% CI' = '95%CI_base', 'p-value' = 'p-value_base', "Hetero-geneity test" = "p-value_heterogeneity_base",
         'OR ' = 'OR_adjusted', '95% CI ' = '95%CI_adjusted', 'p-value ' = 'p-value_adjusted', "Hetero-geneity test " = "p-value_heterogeneity_adjusted",
         ' OR ' = 'OR_copollutant', ' 95% CI ' = '95%CI_copollutant', ' p-value ' = 'p-value_copollutant', " Hetero-geneity test " = "p-value_heterogeneity_copollutant") |>
  flextable() |>
  add_footer_lines(
  "1POPs were summed as follows: Dioxin-like PCBs corresponds to PCBs 118 and 156; non-dioxin-like PCBs corresponds to PCBs 28, 52, 74, 99, 101, 138, 153, 170, 180, 183, 187; most prevalent PCBs corresponds to PCBs 118, 138, 153, 180; Œ£DDT corresponds to p,p‚Äô-DDT and p,p‚Äô-DDE and finally Œ£chlordane corresponds to trans-nonanchlor and oxychlordane.
  2Base and adjusted models are conditional logistic regressions matched for sex and age, and for municipality and serum thawing history (Finnish cohorts). Adjusted models further account for smoking, BMI, serum total cholesterol, marital status, and education (except for FMC cohort for which education data was not available). Co-pollutant models further include all chemicals, where the chemical of interest is categorized into quartiles, while the others are treated as smooth terms in GAMs.
  3Estimated risk of ALS when exposures to POP are at quartiles 2, 3, and 4, compared to quartile 1.
  4CI: Confidence interval.
  5P-value of between-study heterogeneity (Cochran‚Äôs Q test).") |>
  add_header(
    "Exposures" = "Exposures", "Quartiles" = "Quartiles",
    "OR" = "Base model", "95% CI" = "Base model", "p-value" = "Base model", "Hetero-geneity test" = "Base model",
    "OR " = "Adjusted model", "95% CI " = "Adjusted model", "p-value " = "Adjusted model", "Hetero-geneity test " = "Adjusted model",
    " OR " = "Copollutant model", " 95% CI " = "Copollutant model", " p-value " = "Copollutant model", " Hetero-geneity test " = "Copollutant model") |>
  merge_h(part = "header") |>
  merge_v(j = "Exposures") |>
  theme_vanilla() |>
  bold(j = "Exposures", part = "body") |>
  align(align = "center", part = "all") |>
  align(j = "Exposures", align = "left", part = "all") |> 
  merge_at(j = "Exposures", part = "header") |>
  merge_at(j = "Quartiles", part = "header") |>
  flextable::font(fontname = "Calibri", part = "all") |> 
  fontsize(size = 10, part = "all") |>
  padding(padding.top = 0, padding.bottom = 0, part = "all")|>
  set_table_properties(align = "left")
table_S4
rm(extra_rows, table_S4)
```

# POPs ans ALS survival

## Subjects characteristics (among cases only)

```{r}
#| echo: false
#| message: false
#| warning: false
#| paged-print: false
results_descriptive$comp$covar_comp_cases |>
  as_flex_table() |>
  flextable::font(fontname = "Calibri", part = "all") |> 
  fontsize(size = 10, part = "all") |>
  padding(padding.top = 0, padding.bottom = 0, part = "all") |>
  set_table_properties(align = "left")
```

## Danish cohort

### Effects of subject characteristics on ALS survival

```{r}
#| echo: false
#| message: false
#| warning: false
results_POPs_ALS_survival$main_analysis$covar_danish |>
  as_flex_table() |>
  flextable::font(fontname = "Calibri", part = "all") |> 
  fontsize(size = 10, part = "all") |>
  padding(padding.top = 0, padding.bottom = 0, part = "all") |>
  set_table_properties(align = "left")
```

### Effects of POPs on ALS survival

#### Continuous coding (standardized)

```{r}
#| echo: false
#| message: false
#| warning: false
results_POPs_ALS_survival$main_analysis$POPs_sd_ALS_table_danish  |>
  set_table_properties(width = 1, layout = "autofit", align = "left")
```

```{r}
#| echo: false
#| message: false
#| warning: false
results_POPs_ALS_survival$main_analysis$POPs_sd_ALS_figure_danish
```

#### Quartiles

```{r}
#| echo: false
#| message: false
#| warning: false
#| column: screen-inset-right
results_POPs_ALS_survival$main_analysis$POPs_quart_ALS_table_danish |>
  set_table_properties(width = 1, layout = "autofit", align = "left")
```

```{r fig.height=9, fig.width=9}
#| echo: false
#| message: false
#| warning: false
results_POPs_ALS_survival$main_analysis$POPs_quart_ALS_figure_danish
```

#### Cox-gam

```{r fig.height=11, fig.width=8}
#| echo: false
#| message: false
#| warning: false
# wrap_plots(list(results_POPs_ALS_survival$main_analysis$plot_base_cox_gam_danish$PCB_4, 
#                 results_POPs_ALS_survival$main_analysis$plot_adjusted_cox_gam_danish$PCB_4, 
#                 wrap_elements(grid::nullGrob()),
#                 results_POPs_ALS_survival$main_analysis$plot_base_cox_gam_danish$PCB_DL, 
#                 results_POPs_ALS_survival$main_analysis$plot_adjusted_cox_gam_danish$PCB_DL, 
#                 results_POPs_ALS_survival$main_analysis$plot_copollutant_cox_gam_danish$PCB_DL, 
#                 
#                 results_POPs_ALS_survival$main_analysis$plot_base_cox_gam_danish$PCB_NDL, 
#                 results_POPs_ALS_survival$main_analysis$plot_adjusted_cox_gam_danish$PCB_NDL, 
#                 results_POPs_ALS_survival$main_analysis$plot_copollutant_cox_gam_danish$PCB_NDL, 
#                 
#                 results_POPs_ALS_survival$main_analysis$plot_base_cox_gam_danish$OCP_HCB, 
#                 results_POPs_ALS_survival$main_analysis$plot_adjusted_cox_gam_danish$OCP_HCB, 
#                 results_POPs_ALS_survival$main_analysis$plot_copollutant_cox_gam_danish$OCP_HCB), 
#            ncol = 3)
# 
# wrap_plots(list(results_POPs_ALS_survival$main_analysis$plot_base_cox_gam_danish$Œ£DDT, 
#                 results_POPs_ALS_survival$main_analysis$plot_adjusted_cox_gam_danish$Œ£DDT, 
#                 results_POPs_ALS_survival$main_analysis$plot_copollutant_cox_gam_danish$Œ£DDT, 
#                 
#                 results_POPs_ALS_survival$main_analysis$plot_base_cox_gam_danish$OCP_Œ≤_HCH, 
#                 results_POPs_ALS_survival$main_analysis$plot_adjusted_cox_gam_danish$OCP_Œ≤_HCH, 
#                 results_POPs_ALS_survival$main_analysis$plot_copollutant_cox_gam_danish$OCP_Œ≤_HCH, 
#                 
#                 results_POPs_ALS_survival$main_analysis$plot_base_cox_gam_danish$Œ£chlordane, 
#                 results_POPs_ALS_survival$main_analysis$plot_adjusted_cox_gam_danish$Œ£chlordane, 
#                 results_POPs_ALS_survival$main_analysis$plot_copollutant_cox_gam_danish$Œ£chlordane, 
#                 
#                 results_POPs_ALS_survival$main_analysis$plot_base_cox_gam_danish$Œ£PBDE, 
#                 results_POPs_ALS_survival$main_analysis$plot_adjusted_cox_gam_danish$Œ£PBDE, 
#                 results_POPs_ALS_survival$main_analysis$plot_copollutant_cox_gam_danish$Œ£PBDE), 
#            ncol = 3)

wrap_plots(list(results_POPs_ALS_survival$main_analysis$plot_base_cox_gam_danish$PCB_4, 
                results_POPs_ALS_survival$main_analysis$plot_adjusted_cox_gam_danish$PCB_4, 
                
                results_POPs_ALS_survival$main_analysis$plot_base_cox_gam_danish$PCB_DL, 
                results_POPs_ALS_survival$main_analysis$plot_adjusted_cox_gam_danish$PCB_DL, 
                
                results_POPs_ALS_survival$main_analysis$plot_base_cox_gam_danish$PCB_NDL, 
                results_POPs_ALS_survival$main_analysis$plot_adjusted_cox_gam_danish$PCB_NDL, 
                
                results_POPs_ALS_survival$main_analysis$plot_base_cox_gam_danish$OCP_HCB, 
                results_POPs_ALS_survival$main_analysis$plot_adjusted_cox_gam_danish$OCP_HCB), 
           ncol = 2)

wrap_plots(list(results_POPs_ALS_survival$main_analysis$plot_base_cox_gam_danish$Œ£DDT, 
                results_POPs_ALS_survival$main_analysis$plot_adjusted_cox_gam_danish$Œ£DDT, 
                
                results_POPs_ALS_survival$main_analysis$plot_base_cox_gam_danish$OCP_Œ≤_HCH, 
                results_POPs_ALS_survival$main_analysis$plot_adjusted_cox_gam_danish$OCP_Œ≤_HCH, 
                
                results_POPs_ALS_survival$main_analysis$plot_base_cox_gam_danish$Œ£chlordane, 
                results_POPs_ALS_survival$main_analysis$plot_adjusted_cox_gam_danish$Œ£chlordane, 
                
                results_POPs_ALS_survival$main_analysis$plot_base_cox_gam_danish$Œ£PBDE, 
                results_POPs_ALS_survival$main_analysis$plot_adjusted_cox_gam_danish$Œ£PBDE), 
           ncol = 2)

```

#### Q-gcomp analysis

Including all the pollutants

```{r}
#| echo: false
#| message: false
#| warning: false
results_POPs_ALS_survival$main_analysis$qgcomp$POPs_ALS_qgcomp_table_danish  |>
  flextable() |>
  flextable::font(fontname = "Calibri", part = "all") |> 
  fontsize(size = 10, part = "all") |>
  padding(padding.top = 0, padding.bottom = 0, part = "all") |>
  set_table_properties(align = "left")
results_POPs_ALS_survival$main_analysis$qgcomp$POPs_ALS_qgcomp_figure_danish
```

Selecting the pollutants with a positive weight and adjusting for the others

```{r}
#| echo: false
#| message: false
#| warning: false
results_POPs_ALS_survival$main_analysis$qgcomp$POPs_ALS_qgcomp_positive_table_danish  |>
  flextable() |>
  flextable::font(fontname = "Calibri", part = "all") |> 
  fontsize(size = 10, part = "all") |>
  padding(padding.top = 0, padding.bottom = 0, part = "all") |>
  set_table_properties(align = "left")
results_POPs_ALS_survival$main_analysis$qgcomp$POPs_ALS_qgcomp_positive_figure_danish
```

## Sensitivity analyses 1

Mixture models with POPs pre-selection

### Model forcing the covariates to be included

Using LASSO

```{r}
#| echo: false
#| message: false
#| warning: false
plot(results_POPs_ALS_survival$sensi1$sensi1_lasso_sd_danish)  
```

Using ridge

```{r}
#| echo: false
#| message: false
#| warning: false
plot(results_POPs_ALS_survival$sensi1$sensi1_ridge_sd_danish)  
```

Using elastic net

```{r}
#| echo: false
#| message: false
#| warning: false
plot(results_POPs_ALS_survival$sensi1$sensi1_elastic_net_sd_danish)
```

These plot the cross-validation curve (red dotted line) along with upper and lower standard deviation curves along the ùúÜsequence (error bars). Two special values along the ùúÜsequence are indicated by the vertical dotted lines.

lambda.min is the value of ùúÜthat gives minimum mean cross-validated error

coefficients using lambda.min Using LASSO

```{r}
#| echo: false
#| message: false
#| warning: false
coef(results_POPs_ALS_survival$sensi1$sensi1_lasso_sd_danish, s = "lambda.min")  
```

Using ridge

```{r}
#| echo: false
#| message: false
#| warning: false
coef(results_POPs_ALS_survival$sensi1$sensi1_ridge_sd_danish, s = "lambda.min")  
```

Using elastic net

```{r}
#| echo: false
#| message: false
#| warning: false
coef(results_POPs_ALS_survival$sensi1$sensi1_elastic_net_sd_danish, s = "lambda.min")
```

while lambda.1se is the value of ùúÜthat gives the most regularized model such that the cross-validated error is within one standard error of the minimum.

coefficients using lambda.1se Using LASSO

```{r}
#| echo: false
#| message: false
#| warning: false
coef(results_POPs_ALS_survival$sensi1$sensi1_lasso_sd_danish, s = "lambda.1se")  
```

Using ridge

```{r}
#| echo: false
#| message: false
#| warning: false
coef(results_POPs_ALS_survival$sensi1$sensi1_ridge_sd_danish, s = "lambda.1se")  
```

Using elastic net

```{r}
#| echo: false
#| message: false
#| warning: false
coef(results_POPs_ALS_survival$sensi1$sensi1_elastic_net_sd_danish, s = "lambda.1se")
```

### New co-pollutant model with selected POPs using elastic net (to get unbiaised coefficients and 95%CI and p-values)

#### Continuous coding

```{r}
#| echo: false
#| message: false
#| warning: false
results_POPs_ALS_survival$sensi1$POPs_sd_ALS_figure_sensi1_danish
results_POPs_ALS_survival$sensi1$POPs_sd_ALS_table_sensi1_danish
```

#### Quartile coding

```{r}
#| echo: false
#| message: false
#| warning: false
results_POPs_ALS_survival$sensi1$POPs_quart_ALS_figure_sensi1_danish
results_POPs_ALS_survival$sensi1$POPs_quart_ALS_table_sensi1_danish
```

### ERS model with the POPs selestec with elastic net

#### Continuous coding (standardized)

```{r}
#| echo: false
#| message: false
#| warning: false
results_POPs_ALS_survival$sensi1$POPs_sd_ALS_figure_sensi1_ERS_danish
results_POPs_ALS_survival$sensi1$POPs_sd_ALS_table_sensi1_ERS_danish
```

#### Quartile coding

```{r}
#| echo: false
#| message: false
#| warning: false
results_POPs_ALS_survival$sensi1$POPs_quart_ALS_figure_sensi1_ERS_danish
results_POPs_ALS_survival$sensi1$POPs_quart_ALS_table_sensi1_ERS_danish
```

## Sensitivity analyses 2

### Model forcing the covariates to be included

coefficients using lambda.min (lambda.min is the value of ùúÜthat gives minimum mean cross-validated error)

Using LASSO

```{r}
#| echo: false
#| message: false
#| warning: false
coef(results_POPs_ALS_survival$sensi2$sensi2_lasso_sd_danish, s = "lambda.min")  
```

Using elastic net

```{r}
#| echo: false
#| message: false
#| warning: false
coef(results_POPs_ALS_survival$sensi2$sensi2_elastic_net_sd_danish, s = "lambda.min")
```

### New co-pollutant model with selected POPs using elastic net (to get unbiaised coefficients and 95%CI and p-values)

#### Continuous coding (standardized)

```{r}
#| echo: false
#| message: false
#| warning: false
results_POPs_ALS_survival$sensi2$POPs_sd_ALS_figure_sensi2_danish
results_POPs_ALS_survival$sensi2$POPs_sd_ALS_table_sensi2_danish
```

#### Quartile coding

```{r}
#| echo: false
#| message: false
#| warning: false
results_POPs_ALS_survival$sensi2$POPs_quart_ALS_figure_sensi2_danish
results_POPs_ALS_survival$sensi2$POPs_quart_ALS_table_sensi2_danish
```

### ERS model with the POPs selestec with elastic net

#### Continuous coding (standardized)

```{r}
#| echo: false
#| message: false
#| warning: false
results_POPs_ALS_survival$sensi2$POPs_sd_ALS_figure_sensi2_ERS_danish
results_POPs_ALS_survival$sensi2$POPs_sd_ALS_table_sensi2_ERS_danish
```

#### Quartile coding

```{r}
#| echo: false
#| message: false
#| warning: false
results_POPs_ALS_survival$sensi2$POPs_quart_ALS_figure_sensi2_ERS_danish
results_POPs_ALS_survival$sensi2$POPs_quart_ALS_table_sensi2_ERS_danish
```

## Sensitivity analyses 3

```{r}
#| echo: false
#| message: false
#| warning: false
results_POPs_ALS_survival$sensi3$sensi3_figure
```

```{r}
#| echo: false
#| message: false
#| warning: false
results_POPs_ALS_survival$sensi3$sensi3_table
```

## Sensitivity analysis 4

### Cox models (sd)

```{r}
#| echo: false
#| message: false
#| warning: false
results_POPs_ALS_survival$sensi4$POPs_sd_ALS_table_danish_sensi_4
results_POPs_ALS_survival$sensi4$POPs_sd_ALS_figure_danish_sensi_4
```

### Cox-GAMs models

```{r fig.height=11, fig.width=8}
#| echo: false
#| message: false
#| warning: false

wrap_plots(list(results_POPs_ALS_survival$main_analysis$plot_adjusted_cox_gam_danish$PCB_4,
                results_POPs_ALS_survival$sensi4$plot_adjusted_cox_gam_danish_sensi_4$PCB_4,
                
                results_POPs_ALS_survival$main_analysis$plot_adjusted_cox_gam_danish$PCB_DL,
                results_POPs_ALS_survival$sensi4$plot_adjusted_cox_gam_danish_sensi_4$PCB_DL,
                
                results_POPs_ALS_survival$main_analysis$plot_adjusted_cox_gam_danish$PCB_NDL,
                results_POPs_ALS_survival$sensi4$plot_adjusted_cox_gam_danish_sensi_4$PCB_NDL,
                
                results_POPs_ALS_survival$main_analysis$plot_adjusted_cox_gam_danish$OCP_HCB,
                results_POPs_ALS_survival$sensi4$plot_adjusted_cox_gam_danish_sensi_4$OCP_HCB), 
           ncol = 2)

wrap_plots(list(
                results_POPs_ALS_survival$main_analysis$plot_adjusted_cox_gam_danish$Œ£DDT,
                results_POPs_ALS_survival$sensi4$plot_adjusted_cox_gam_danish_sensi_4$Œ£DDT, 
                
                results_POPs_ALS_survival$main_analysis$plot_adjusted_cox_gam_danish$OCP_Œ≤_HCH,
                results_POPs_ALS_survival$sensi4$plot_adjusted_cox_gam_danish_sensi_4$OCP_Œ≤_HCH,
                
                results_POPs_ALS_survival$main_analysis$plot_adjusted_cox_gam_danish$Œ£chlordane,
                results_POPs_ALS_survival$sensi4$plot_adjusted_cox_gam_danish_sensi_4$Œ£chlordane,
                
                results_POPs_ALS_survival$main_analysis$plot_adjusted_cox_gam_danish$Œ£PBDE,
                results_POPs_ALS_survival$sensi4$plot_adjusted_cox_gam_danish_sensi_4$Œ£PBDE), 
           ncol = 2)

```

# Fatty acids and ALS occurence

## Danish cohort

### Effects of subject characterist on ALS occurence in the Danish cohort

```{r}
#| echo: false
#| message: false
#| warning: false
results_fattyacids_ALS_occurrence$danish$covar_als_table_danish  |>
  set_table_properties(width = 1, layout = "autofit", align = "left")
```

### Effects of fatty acids on ALS occurence in the Danish cohort

#### Continuous coding (standardized)

```{r}
#| echo: false
#| message: false
#| warning: false
results_fattyacids_ALS_occurrence$danish$fattyacids_sd_als_table_danish |>
  set_table_properties(width = 1, layout = "autofit", align = "left")
```

```{r}
#| echo: false
#| message: false
#| warning: false
results_fattyacids_ALS_occurrence$danish$fattyacids_sd_als_figure_danish
```

#### Quartiles

```{r}
#| echo: false
#| message: false
#| warning: false
results_fattyacids_ALS_occurrence$danish$fattyacids_quart_als_table_danish |>
  set_table_properties(width = 1, layout = "autofit", align = "left")
```

```{r, fig.height=12}
#| echo: false
#| message: false
#| warning: false
results_fattyacids_ALS_occurrence$danish$fattyacids_quart_als_figure_danish
```

## Finnish cohorts

### Effects of subject characteristics on ALS occurence in the Finnish cohorts

```{r}
#| echo: false
#| message: false
#| warning: false

```

### Effects of fatty acids on ALS occurence in the Finnish cohorts

#### Continuous coding (standardized)

```{r}
#| echo: false
#| message: false
#| warning: false
results_fattyacids_ALS_occurrence$finnish$fattyacids_sd_als_table_finnish |>
  set_table_properties(width = 1, layout = "autofit", align = "left")
```

```{r}
#| echo: false
#| message: false
#| warning: false
results_fattyacids_ALS_occurrence$finnish$fattyacids_sd_als_figure_finnish
```

#### Quartiles

```{r}
#| echo: false
#| message: false
#| warning: false
results_fattyacids_ALS_occurrence$finnish$fattyacids_quart_als_table_finnish |>
  set_table_properties(width = 1, layout = "autofit", align = "left")
```

```{r, fig.height=12}
#| echo: false
#| message: false
#| warning: false
results_fattyacids_ALS_occurrence$finnish$fattyacids_quart_als_figure_finnish
```

### Sensitivity Ca

#### Continuous coding (standardized)

```{r}
#| echo: false
#| message: false
#| warning: false
results_fattyacids_ALS_occurrence$sensi_ca$fattyacids_sd_als_table_sensi_ca_finnish 
results_fattyacids_ALS_occurrence$sensi_ca$fattyacids_sd_als_figure_sensi_ca_finnish
```

#### Quartiles

```{r}
#| echo: false
#| message: false
#| warning: false
results_fattyacids_ALS_occurrence$sensi_ca$fattyacids_quart_als_table_sensi_ca_finnish 
```

```{r, fig.height=13}
#| echo: false
#| message: false
#| warning: false
results_fattyacids_ALS_occurrence$sensi_ca$fattyacids_quart_als_figure_sensi_ca_finnish
```

# Fatty acids ans ALS survival

## Danish cohort

### Effects of covariates on ALS survival

```{r}
#| echo: false
#| message: true
#| warning: false
results_fattyacids_ALS_survival$danish$covar_danish |>
  as_flex_table() |>
  flextable::font(fontname = "Calibri", part = "all") |> 
  fontsize(size = 10, part = "all") |>
  padding(padding.top = 0, padding.bottom = 0, part = "all") |>
  set_table_properties(align = "left")
```

### Continuous coding (standardized)

```{r}
#| echo: false
#| message: false
#| warning: false
results_fattyacids_ALS_survival$danish$fattyacids_sd_als_table_danish |>
  set_table_properties(width = 1, layout = "autofit", align = "left")
results_fattyacids_ALS_survival$danish$fattyacids_sd_als_figure_danish
```

### Quartiles

```{r}
#| echo: false
#| message: false
#| warning: false
results_fattyacids_ALS_survival$danish$fattyacids_quart_als_table_danish |>
  set_table_properties(width = 1, layout = "autofit", align = "left")
```

```{r, fig.height=12}
#| echo: false
#| message: false
#| warning: false
results_fattyacids_ALS_survival$danish$fattyacids_quart_als_figure_danish
```

```{r, fig.height=12, fig.width=12}
#| echo: false
#| message: false
#| warning: false
#| column: screen-inset-right
arrange_ggsurvplots(
  results_fattyacids_ALS_survival$danish$survival_plots_danish[1:4],
  ncol = 2,              
  nrow = 2)
```

## Finnish cohorts

### Effects of covariates on ALS survival

To be done

```{r}
#| echo: false
#| message: true
#| warning: false
```

### Continuous coding (standardized)

```{r}
#| echo: false
#| message: false
#| warning: false
results_fattyacids_ALS_survival$finnish$fattyacids_sd_als_table_finnish |>
  set_table_properties(width = 1, layout = "autofit", align = "left")
results_fattyacids_ALS_survival$finnish$fattyacids_sd_als_figure_finnish
```

### Quartiles

```{r}
#| echo: false
#| message: false
#| warning: false
results_fattyacids_ALS_survival$finnish$fattyacids_quart_als_table_finnish |>
  set_table_properties(width = 1, layout = "autofit", align = "left")
```

```{r, fig.height=12}
#| echo: false
#| message: false
#| warning: false
results_fattyacids_ALS_survival$finnish$fattyacids_quart_als_figure_finnish
```

## Comparison of the results

```{r, fig.height=10}
#| echo: false
#| message: false
#| warning: false
results_fattyacids_ALS_survival$comp_results_danish_finnish
```


# NEFL and ALS 
## NEFL and ALS risk
### Main analysis
```{r}
#| echo: false
#| message: false
#| warning: false
wrap_plots(results_proteomic_ALS_occurrence$sensi_1$plot_base_gam_sensi_1$signif$proteomic_neuro_explo_NEFL_sensi_1,  
           results_proteomic_ALS_occurrence$sensi_1$plot_adjusted_gam_sensi_1$signif$proteomic_neuro_explo_NEFL_sensi_1)
```

### Sensitivity analysis
Filtering the data to follow-up > 5 years
```{r}
#| echo: false
#| message: false
#| warning: false
wrap_plots(results_proteomic_ALS_occurrence$sensi_1$plot_adjusted_gam_sensi_1$signif$proteomic_neuro_explo_NEFL_sensi_1, 
           results_proteomic_ALS_occurrence$sensi_2$plot_adjusted_gam_sensi_2$signif$proteomic_neuro_explo_NEFL, 
           results_proteomic_ALS_occurrence$sensi_1_3$plot_adjusted_gam_sensi_1_3$signif$proteomic_neuro_explo_NEFL_sensi_1_3, 
           results_proteomic_ALS_occurrence$sensi_1_3_4$plot_adjusted_gam_sensi_1_3_4$signif$proteomic_neuro_explo_NEFL_sensi_1_3_4, 
           results_proteomic_ALS_occurrence$sensi_1_3_5$plot_adjusted_gam_sensi_1_3_5$not_signif$proteomic_neuro_explo_NEFL_sensi_1_3_5)
```

### Additional analysis 
NEFL over time
```{r}
#| echo: false
#| message: false
#| warning: false
results_proteomic_ALS_occurrence$additional_analysis_2$figure_NEFL_over_time_sensi_1
```

## NEFL and ALS survival 
```{r}
#| echo: false
#| message: false
#| warning: false
wrap_plots(results_proteomic_ALS_survival$plot_base_cox_gam_danish$NEFL, 
           results_proteomic_ALS_survival$plot_adjusted_cox_gam_danish$NEFL)
```



# Proteomic and ALS occurrence

## Effects of subject characterist on ALS occurence in the Danish cohort

```{r}
#| echo: false
#| message: false
#| warning: false
results_proteomic_ALS_occurrence$main$covar |>
  as_flex_table() |>
  flextable::font(fontname = "Calibri", part = "all") |> 
  fontsize(size = 10, part = "all") |>
  padding(padding.top = 0, padding.bottom = 0, part = "all") |>
  set_table_properties(align = "left")
```

## Main analysis

### Logistic regressions

Conditional logistic regressions (continuous standardized), matched on age at baseline and sex (further adjusted for smoking and body mass index)

```{r, fig.width=15, fig.height=6}
#| echo: false
#| message: false
#| warning: false
results_proteomic_ALS_occurrence$main$proteomic_sd_ALS_table |>
  set_table_properties(width = 1, layout = "autofit", align = "left")
```

```{r, fig.width=15, fig.height=6}
#| echo: false
#| message: false
#| warning: false
#| column: screen-inset-right
results_proteomic_ALS_occurrence$main$proteomic_sd_ALS_base_figure +  theme(legend.position = "none") +
  results_proteomic_ALS_occurrence$main$proteomic_sd_ALS_adjusted_figure + theme(legend.position = "bottom") +
  plot_layout(ncol = 2)
```

Conditional logistic regressions (quartiles), matched on age at baseline and sex (further adjusted for smoking and body mass index)

```{r}
#| echo: false
#| message: false
#| warning: false
#| column: screen-inset-right
results_proteomic_ALS_occurrence$main$proteomic_quart_ALS_table  |>
  set_table_properties(width = 1, layout = "autofit", align = "left")
```

### GAMs

Generalized additive models modeling proteins as smooth terms (thin plate splines), base models adjusted on sex and age at baseline. Adjusted models further account for smoking and body mass index

```{r, fig.width=9, fig.height=60}
#| echo: false
#| message: false
#| warning: false

plots_lists <- list(
  sensi_1_base = results_proteomic_ALS_occurrence$main$plot_base_gam$signif,
  sensi_1_adj  = results_proteomic_ALS_occurrence$main$plot_adjusted_gam$signif)

all_proteins <- sort(unique(unlist(lapply(plots_lists, names))))

plot_grid <- lapply(all_proteins, function(prot) {
  lapply(plots_lists, function(lst) {
    if (prot %in% names(lst)) {
      lst[[prot]]
    } else {
      wrap_elements(grid::nullGrob())
    }
  })
})

wrap_plots(
  unlist(plot_grid, recursive = FALSE),
  ncol = 2) 

rm(plots_lists, all_proteins, plot_grid)


```

## Sensitivity 1: Removing NEFL outlier

### Logistic regressions

Conditional logistic regressions (continuous standardized), matched on age at baseline and sex (further adjusted for smoking and body mass index)

```{r, fig.width=15, fig.height=6}
#| echo: false
#| message: false
#| warning: false
results_proteomic_ALS_occurrence$sensi_1$proteomic_sd_ALS_table_sensi_1 |>
  set_table_properties(width = 1, layout = "autofit", align = "left")
```

```{r, fig.width=15, fig.height=6}
#| echo: false
#| message: false
#| warning: false
#| column: screen-inset-right
results_proteomic_ALS_occurrence$main$proteomic_sd_ALS_base_figure + labs(title = "Main analysis - Base model") + theme(legend.position = "none") +
  results_proteomic_ALS_occurrence$sensi_1$proteomic_sd_ALS_base_figure_sensi_1 + labs(title = "NEFL outlier removed - Base model") + theme(legend.position = "bottom") +
  plot_layout(ncol = 2)
  
results_proteomic_ALS_occurrence$main$proteomic_sd_ALS_adjusted_figure + labs(title = "Main analysis - adjusted model") + theme(legend.position = "none") +
  results_proteomic_ALS_occurrence$sensi_1$proteomic_sd_ALS_adjusted_figure_sensi_1 + labs(title = "NEFL outlier removed - Adjusted model") + theme(legend.position = "bottom") +
  plot_layout(ncol = 2)
```

Conditional logistic regressions (quartiles), matched on age at baseline and sex (further adjusted for smoking and body mass index)

```{r}
#| echo: false
#| message: false
#| warning: false
#| column: screen-inset-right
results_proteomic_ALS_occurrence$sensi_1$proteomic_quart_ALS_table_sensi_1 |>
  set_table_properties(width = 1, layout = "autofit", align = "left")
```

### GAMs

Generalized additive models modeling proteins as smooth terms (thin plate splines), base models adjusted on sex and age at baseline. Adjusted models further account for smoking and body mass index

```{r, fig.width=10, fig.height=5}
#| echo: false
#| message: false
#| warning: false
wrap_plots(results_proteomic_ALS_occurrence$main$plot_base_gam$signif$proteomic_neuro_explo_NEFL,
           results_proteomic_ALS_occurrence$sensi_1$plot_base_gam_sensi_1$signif$proteomic_neuro_explo_NEFL_sensi_1, 
           ncol = 2)
```

```{r, fig.width=10, fig.height=5}
#| echo: false
#| message: false
#| warning: false
wrap_plots(results_proteomic_ALS_occurrence$main$plot_adjusted_gam$signif$proteomic_neuro_explo_NEFL,
           results_proteomic_ALS_occurrence$sensi_1$plot_adjusted_gam_sensi_1$signif$proteomic_neuro_explo_NEFL_sensi_1, 
           ncol = 2)
```


## Sensitivity 2: Filtering to cases and their controls with follow-up < 5 years

### Logistic regressions 
```{r fig.height=6, fig.width=15}
#| echo: false
#| message: false
#| warning: false

### Logistic regressions
# Conditional logistic regressions (continuous standardized), matched on age at baseline and sex (further adjusted for smoking and body mass index)
results_proteomic_ALS_occurrence$sensi_2$proteomic_sd_ALS_table_sensi_2 |>
  set_table_properties(width = 1, layout = "autofit", align = "left")


results_proteomic_ALS_occurrence$main$proteomic_sd_ALS_base_figure + labs(title = "Main analysis - Base model") + theme(legend.position = "none") + 
  results_proteomic_ALS_occurrence$sensi_2$proteomic_sd_ALS_base_figure_sensi_2 + labs(title = "Filtered to follow-up < 5 years - Base model") + theme(legend.position = "bottom") +
  plot_layout(ncol = 2)

results_proteomic_ALS_occurrence$main$proteomic_sd_ALS_adjusted_figure + labs(title = "Main analysis - Adjusted model") + theme(legend.position = "none") + 
  results_proteomic_ALS_occurrence$sensi_2$proteomic_sd_ALS_adjusted_figure_sensi_2 + labs(title = "Filtered to follow-up < 5 years - Adjusted model") + theme(legend.position = "bottom") +
  plot_layout(ncol = 2)
```

```{r}
#| echo: false
#| message: false
#| warning: false
#| column: screen-inset-right

# Conditional logistic regressions (quartiles), matched on age at baseline and sex (further adjusted for smoking and body mass index)
results_proteomic_ALS_occurrence$sensi_3$proteomic_quart_ALS_table_sensi_3 |>
  set_table_properties(width = 1, layout = "autofit", align = "left")
```

### GAMs
```{r fig.height=60, fig.width=9}
#| echo: false
#| message: false
#| warning: false
### GAMs 
# Generalized additive models modeling proteins as smooth terms (thin plate splines), base models adjusted on sex and age at baseline. Adjusted models further account for smoking and body mass index

plots_lists <- list(
  sensi_1_base = results_proteomic_ALS_occurrence$sensi_1$plot_base_gam_sensi_1$signif,
  sensi_1_adj  = results_proteomic_ALS_occurrence$sensi_1$plot_adjusted_gam_sensi_1$signif,
  sensi_2_base = results_proteomic_ALS_occurrence$sensi_2$plot_base_gam_sensi_2$signif,
  sensi_2_adj  = results_proteomic_ALS_occurrence$sensi_2$plot_adjusted_gam_sensi_2$signif)

all_proteins <- sort(unique(unlist(lapply(plots_lists, names))))

plot_grid <- lapply(all_proteins, function(prot) {
  lapply(plots_lists, function(lst) {
    if (prot %in% names(lst)) {
      lst[[prot]]
    } else {
      wrap_elements(grid::nullGrob())
    }
  })
})

wrap_plots(
  unlist(plot_grid, recursive = FALSE),
  ncol = 4) 

rm(plots_lists, all_proteins, plot_grid)

```

## Sensitivity 3: Filtering to cases and their controls with follow-up > 5 years

### Logistic regressions 
```{r fig.height=6, fig.width=15}
#| echo: false
#| message: false
#| warning: false

### Logistic regressions
# Conditional logistic regressions (continuous standardized), matched on age at baseline and sex (further adjusted for smoking and body mass index)
results_proteomic_ALS_occurrence$sensi_3$proteomic_sd_ALS_table_sensi_3 |>
  set_table_properties(width = 1, layout = "autofit", align = "left")


results_proteomic_ALS_occurrence$main$proteomic_sd_ALS_base_figure + labs(title = "Main analysis - Base model") + theme(legend.position = "none") + 
  results_proteomic_ALS_occurrence$sensi_3$proteomic_sd_ALS_base_figure_sensi_3 + labs(title = "Filtered to follow-up > 5 years - Base model") + theme(legend.position = "bottom") +
  plot_layout(ncol = 2)

results_proteomic_ALS_occurrence$main$proteomic_sd_ALS_adjusted_figure + labs(title = "Main analysis - Adjusted model") + theme(legend.position = "none") + 
  results_proteomic_ALS_occurrence$sensi_3$proteomic_sd_ALS_adjusted_figure_sensi_3 + labs(title = "Filtered to follow-up > 5years - Adjusted model") + theme(legend.position = "bottom") +
  plot_layout(ncol = 2)
```

```{r}
#| echo: false
#| message: false
#| warning: false
#| column: screen-inset-right

# Conditional logistic regressions (quartiles), matched on age at baseline and sex (further adjusted for smoking and body mass index)
results_proteomic_ALS_occurrence$sensi_3$proteomic_quart_ALS_table_sensi_3 |>
  set_table_properties(width = 1, layout = "autofit", align = "left")
```

### GAMs
```{r fig.height=60, fig.width=9}
#| echo: false
#| message: false
#| warning: false
### GAMs 
# Generalized additive models modeling proteins as smooth terms (thin plate splines), base models adjusted on sex and age at baseline. Adjusted models further account for smoking and body mass index
plots_lists <- list(
  sensi_1_base = results_proteomic_ALS_occurrence$sensi_1$plot_base_gam_sensi_1$signif,
  sensi_1_adj  = results_proteomic_ALS_occurrence$sensi_1$plot_adjusted_gam_sensi_1$signif,
  sensi_3_base = results_proteomic_ALS_occurrence$sensi_3$plot_base_gam_sensi_3$signif,
  sensi_3_adj  = results_proteomic_ALS_occurrence$sensi_3$plot_adjusted_gam_sensi_3$signif)

all_proteins <- sort(unique(unlist(lapply(plots_lists, names))))

plot_grid <- lapply(all_proteins, function(prot) {
  lapply(plots_lists, function(lst) {
    if (prot %in% names(lst)) {
      lst[[prot]]
    } else {
      wrap_elements(grid::nullGrob())
    }
  })
})

wrap_plots(
  unlist(plot_grid, recursive = FALSE),
  ncol = 4) 

rm(plots_lists, all_proteins, plot_grid)



```

## Sensitivity 1 + 3: Removing NEFL outlier + filtering cases and their controls with follow-up > 5 years

### Logistic regressions

Conditional logistic regressions (continuous standardized), matched on age at baseline and sex (further adjusted for smoking and body mass index)

```{r, fig.width=15, fig.height=6}
#| echo: false
#| message: false
#| warning: false

results_proteomic_ALS_occurrence$sensi_1_3$proteomic_sd_ALS_table_sensi_1_3 |>
  set_table_properties(width = 1, layout = "autofit", align = "left")
```

```{r, fig.width=15, fig.height=6}
#| echo: false
#| message: false
#| warning: false
#| column: screen-inset-right
results_proteomic_ALS_occurrence$sensi_1$proteomic_sd_ALS_base_figure_sensi_1 + 
  labs(title = "NEFL outlier removed \n Base model") + 
  theme(legend.position = "none") + 
  results_proteomic_ALS_occurrence$sensi_1_3$proteomic_sd_ALS_base_figure_sensi_1_3 + 
  labs(title = "Filtered to follow-up>5years\n+ NEFL outlier excluded \n Base model") + 
  theme(legend.position = "bottom") +
  plot_layout(ncol = 2)
  
results_proteomic_ALS_occurrence$sensi_1$proteomic_sd_ALS_adjusted_figure_sensi_1 + 
  labs(title = "NEFL outlier removed \n Adjusted model") + 
  theme(legend.position = "none") + 
  results_proteomic_ALS_occurrence$sensi_1_3$proteomic_sd_ALS_adjusted_figure_sensi_1_3 + 
  labs(title = "Filtered to follow-up>5years\n+ NEFL outlier excluded \n Adjusted model") + 
  theme(legend.position = "bottom") +
  plot_layout(ncol = 2)
```

Conditional logistic regressions (quartiles), matched on age at baseline and sex (further adjusted for smoking and body mass index)

```{r}
#| echo: false
#| message: false
#| warning: false
#| column: screen-inset-right

results_proteomic_ALS_occurrence$sensi_1_3$proteomic_quart_ALS_table_sensi_1_3 |>
  set_table_properties(width = 1, layout = "autofit", align = "left")
```

### GAMs

Generalized additive models modeling proteins as smooth terms (thin plate splines), base models adjusted on sex and age at baseline. Adjusted models further account for smoking and body mass index

```{r fig.width=12, fig.height=60}
#| echo: false
#| message: false
#| warning: false
#| column: screen-inset-right

plots_lists <- list(
  sensi_1_base = results_proteomic_ALS_occurrence$sensi_1$plot_base_gam_sensi_1$signif,
  sensi_1_adj  = results_proteomic_ALS_occurrence$sensi_1$plot_adjusted_gam_sensi_1$signif,
  sensi_1_3_base = results_proteomic_ALS_occurrence$sensi_1_3$plot_base_gam_sensi_1_3$signif,
  sensi_1_3_adj  = results_proteomic_ALS_occurrence$sensi_1_3$plot_adjusted_gam_sensi_1_3$signif)

all_proteins <- sort(unique(unlist(lapply(plots_lists, names))))

plot_grid <- lapply(all_proteins, function(prot) {
  lapply(plots_lists, function(lst) {
    if (prot %in% names(lst)) {
      lst[[prot]]
    } else {
      wrap_elements(grid::nullGrob())
    }
  })
})

wrap_plots(
  unlist(plot_grid, recursive = FALSE),
  ncol = 4) 

rm(plots_lists, all_proteins, plot_grid)



```



## Sensitivity 1 + 3 + 4: Removing NEFL outlier + filtering cases and their controls with follow-up > 5 years + filtering follow-up < 50%

### Logistic regressions

Conditional logistic regressions (continuous standardized), matched on age at baseline and sex (further adjusted for smoking and body mass index)

```{r, fig.width=15, fig.height=6}
#| echo: false
#| message: false
#| warning: false

results_proteomic_ALS_occurrence$sensi_1_3_4$proteomic_sd_ALS_table_sensi_1_3_4 |>
  set_table_properties(width = 1, layout = "autofit", align = "left")
```

```{r, fig.width=15, fig.height=6}
#| echo: false
#| message: false
#| warning: false
#| column: screen-inset-right
results_proteomic_ALS_occurrence$sensi_1$proteomic_sd_ALS_base_figure_sensi_1 + 
  labs(title = "NEFL outlier removed \n Base model") + 
  theme(legend.position = "none") + 
  results_proteomic_ALS_occurrence$sensi_1_3_4$proteomic_sd_ALS_base_figure_sensi_1_3_4 + 
  labs(title = "NEFL outlier excluded\n+Filtered to follow-up>5years\n+Filtered to follow-up<50%\nBase model") + 
  theme(legend.position = "bottom") +
  plot_layout(ncol = 2)
  
results_proteomic_ALS_occurrence$sensi_1$proteomic_sd_ALS_adjusted_figure_sensi_1 + 
  labs(title = "NEFL outlier removed \n Adjusted model") + 
  theme(legend.position = "none") + 
  results_proteomic_ALS_occurrence$sensi_1_3_4$proteomic_sd_ALS_adjusted_figure_sensi_1_3_4 + 
  labs(title = "NEFL outlier excluded\n+Filtered to follow-up>5years\n+Filtered to follow-up<50%\nAdjusted model") + 
  theme(legend.position = "bottom") +
  plot_layout(ncol = 2)
```

Conditional logistic regressions (quartiles), matched on age at baseline and sex (further adjusted for smoking and body mass index)

```{r}
#| echo: false
#| message: false
#| warning: false
#| column: screen-inset-right

results_proteomic_ALS_occurrence$sensi_1_3_4$proteomic_quart_ALS_table_sensi_1_3_4 |>
  set_table_properties(width = 1, layout = "autofit", align = "left")
```

### GAMs

Generalized additive models modeling proteins as smooth terms (thin plate splines), base models adjusted on sex and age at baseline. Adjusted models further account for smoking and body mass index

```{r fig.width=12, fig.height=60}
#| echo: false
#| message: false
#| warning: false
#| column: screen-inset-right

plots_lists <- list(
  sensi_1_base = results_proteomic_ALS_occurrence$sensi_1$plot_base_gam_sensi_1$signif,
  sensi_1_adj  = results_proteomic_ALS_occurrence$sensi_1$plot_adjusted_gam_sensi_1$signif,
  sensi_1_3_4_base = results_proteomic_ALS_occurrence$sensi_1_3_4$plot_base_gam_sensi_1_3_4$signif,
  sensi_1_3_4_adj  = results_proteomic_ALS_occurrence$sensi_1_3_4$plot_adjusted_gam_sensi_1_3_4$signif)

all_proteins <- sort(unique(unlist(lapply(plots_lists, names))))

plot_grid <- lapply(all_proteins, function(prot) {
  lapply(plots_lists, function(lst) {
    if (prot %in% names(lst)) {
      lst[[prot]]
    } else {
      wrap_elements(grid::nullGrob())
    }
  })
})

wrap_plots(
  unlist(plot_grid, recursive = FALSE),
  ncol = 4) 

rm(plots_lists, all_proteins, plot_grid)

```




## Sensitivity 1 + 3 + 5: Removing NEFL outlier + filtering cases and their controls with follow-up > 5 years + filtering follow-up > 50%

### Logistic regressions

Conditional logistic regressions (continuous standardized), matched on age at baseline and sex (further adjusted for smoking and body mass index)

```{r, fig.width=15, fig.height=6}
#| echo: false
#| message: false
#| warning: false

results_proteomic_ALS_occurrence$sensi_1_3_5$proteomic_sd_ALS_table_sensi_1_3_5 |>
  set_table_properties(width = 1, layout = "autofit", align = "left")
```

```{r, fig.width=15, fig.height=6}
#| echo: false
#| message: false
#| warning: false
#| column: screen-inset-right
results_proteomic_ALS_occurrence$sensi_1$proteomic_sd_ALS_base_figure_sensi_1 + 
  labs(title = "NEFL outlier removed \n Base model") + 
  theme(legend.position = "none") + 
  results_proteomic_ALS_occurrence$sensi_1_3_5$proteomic_sd_ALS_base_figure_sensi_1_3_5 + 
  labs(title = "NEFL outlier excluded\n+Filtered to follow-up>5years\n+Filtered to follow-up>50%\nBase model") + 
  theme(legend.position = "bottom") +
  plot_layout(ncol = 2)
  
results_proteomic_ALS_occurrence$sensi_1$proteomic_sd_ALS_adjusted_figure_sensi_1 + 
  labs(title = "NEFL outlier removed \n Adjusted model") + 
  theme(legend.position = "none") + 
  results_proteomic_ALS_occurrence$sensi_1_3_5$proteomic_sd_ALS_adjusted_figure_sensi_1_3_5 + 
  labs(title = "NEFL outlier excluded\n+Filtered to follow-up>5years\n+Filtered to follow-up>50%\nAdjusted model") + 
  theme(legend.position = "bottom") +
  plot_layout(ncol = 2)
```

Conditional logistic regressions (quartiles), matched on age at baseline and sex (further adjusted for smoking and body mass index)

```{r}
#| echo: false
#| message: false
#| warning: false
#| column: screen-inset-right

results_proteomic_ALS_occurrence$sensi_1_3_5$proteomic_quart_ALS_table_sensi_1_3_5 |>
  set_table_properties(width = 1, layout = "autofit", align = "left")
```

### GAMs

Generalized additive models modeling proteins as smooth terms (thin plate splines), base models adjusted on sex and age at baseline. Adjusted models further account for smoking and body mass index

```{r fig.width=12, fig.height=60}
#| echo: false
#| message: false
#| warning: false
#| column: screen-inset-right

plots_lists <- list(
  sensi_1_base = results_proteomic_ALS_occurrence$sensi_1$plot_base_gam_sensi_1$signif,
  sensi_1_adj  = results_proteomic_ALS_occurrence$sensi_1$plot_adjusted_gam_sensi_1$signif,
  sensi_1_3_5_base = results_proteomic_ALS_occurrence$sensi_1_3_5$plot_base_gam_sensi_1_3_5$signif,
  sensi_1_3_5_adj  = results_proteomic_ALS_occurrence$sensi_1_3_5$plot_adjusted_gam_sensi_1_3_5$signif)

all_proteins <- sort(unique(unlist(lapply(plots_lists, names))))

plot_grid <- lapply(all_proteins, function(prot) {
  lapply(plots_lists, function(lst) {
    if (prot %in% names(lst)) {
      lst[[prot]]
    } else {
      wrap_elements(grid::nullGrob())
    }
  })
})

wrap_plots(
  unlist(plot_grid, recursive = FALSE),
  ncol = 4) 

rm(plots_lists, all_proteins, plot_grid)

```

## Sensitivity 6: stratifiyng the analysis in tertiles of follow-up duration

Data not shown because of merging sensi 1 and sensi 6

```{r fig.width=15, fig.height=12}
#| eval: false
#| message: false
#| warning: false
#| include: false

### Logistic regressions
# Conditional logistic regressions (continuous standardized), matched on age at baseline and sex (further adjusted for smoking and body mass index)
results_proteomic_ALS_occurrence$main$proteomic_sd_ALS_base_figure + labs(title = "Main analysis - full sample size") + theme(legend.position = "none") +
  results_proteomic_ALS_occurrence$sensi_6$proteomic_sd_ALS_base_figure_sensi_6_T1 + labs(title = "Filtered to follow-up T1 (<11 years)") + theme(legend.position = "none") +
  results_proteomic_ALS_occurrence$sensi_6$proteomic_sd_ALS_base_figure_sensi_6_T2 + labs(title = "Filtered to follow-up T2 (11-16 years)") + theme(legend.position = "none") +
  results_proteomic_ALS_occurrence$sensi_6$proteomic_sd_ALS_base_figure_sensi_6_T3 + labs(title = "Filtered to follow-up T3 (>16 years)") + theme(legend.position = "bottom") 
  
results_proteomic_ALS_occurrence$main$proteomic_sd_ALS_adjusted_figure + labs(title = "Main analysis - full sample size") + theme(legend.position = "none") +
  results_proteomic_ALS_occurrence$sensi_6$proteomic_sd_ALS_adjusted_figure_sensi_6_T1 + labs(title = "Filtered to follow-up T1 (<11 years)") + theme(legend.position = "none") +
  results_proteomic_ALS_occurrence$sensi_6$proteomic_sd_ALS_adjusted_figure_sensi_6_T2 + labs(title = "Filtered to follow-up T2 (11-16 years)") + theme(legend.position = "none") +
  results_proteomic_ALS_occurrence$sensi_6$proteomic_sd_ALS_adjusted_figure_sensi_6_T3 + labs(title = "Filtered to follow-up T3 (>16 years)") + theme(legend.position = "bottom") 
```

## Sensitivity 1 + 6: Removing NEFL outlier + stratifiyng the analysis in tertiles of follow-up duration

```{r}
#| echo: false
#| message: false
#| warning: false
results_proteomic_ALS_occurrence$sensi_6$sensi_6_table_follow_up
results_proteomic_ALS_occurrence$sensi_6$sensi_6_densityplot_follow_up
```

### Logistic regressions

Conditional logistic regressions (continuous standardized), matched on age at baseline and sex (further adjusted for smoking and body mass index)

```{r fig.width=15, fig.height=12}
#| echo: false
#| message: false
#| warning: false
#| column: screen-inset-right
results_proteomic_ALS_occurrence$sensi_1$proteomic_sd_ALS_base_figure_sensi_1 + labs(title = "NEFL outlier removed \n Base model") + theme(legend.position = "none") +
results_proteomic_ALS_occurrence$sensi_1_6$proteomic_sd_ALS_base_figure_sensi_1_6_T1 + labs(title = "Filtered to follow-up T1 (<11 years)\n+ NEFL outlier excluded \n Base model") + theme(legend.position = "none") +
results_proteomic_ALS_occurrence$sensi_1_6$proteomic_sd_ALS_base_figure_sensi_1_6_T2 + labs(title = "Filtered to follow-up T2 (11-16 years)\n+ NEFL outlier excluded \n Base model") + theme(legend.position = "none") +
results_proteomic_ALS_occurrence$sensi_1_6$proteomic_sd_ALS_base_figure_sensi_1_6_T3 + labs(title = "Filtered to follow-up T3 (>16 years)\n+ NEFL outlier excluded \n Base model") + theme(legend.position = "bottom")  
  
  
results_proteomic_ALS_occurrence$sensi_1$proteomic_sd_ALS_adjusted_figure_sensi_1 + labs(title = "NEFL outlier removed \n Adjusted model") + theme(legend.position = "none") +
results_proteomic_ALS_occurrence$sensi_1_6$proteomic_sd_ALS_adjusted_figure_sensi_1_6_T1 + labs(title = "Filtered to follow-up T1 (<11 years)\n+ NEFL outlier excluded \n Adjusted model") + theme(legend.position = "none") +
results_proteomic_ALS_occurrence$sensi_1_6$proteomic_sd_ALS_adjusted_figure_sensi_1_6_T2 + labs(title = "Filtered to follow-up T2 (11-16 years)\n+ NEFL outlier excluded \n Adjusted model") + theme(legend.position = "none") +
results_proteomic_ALS_occurrence$sensi_1_6$proteomic_sd_ALS_adjusted_figure_sensi_1_6_T3 + labs(title = "Filtered to follow-up T3 (>16 years)\n+ NEFL outlier excluded \n Adjusted model") + theme(legend.position = "bottom")  
```

NEFL is not significantly associated with ALS occurence when the follow-up duration is \>16 years. We don't see many associations in the follow-up group T1: I suspect that it is because of high heterogeneity in follow-up duration among this sub-group (0-11 years). --\> then I trust more the sensi 2 results where we just remove the cases (and their controls) with follow-up \<5 years.

## Additionnal analysis 1

```{r}
#| echo: false
#| message: false
#| warning: false
shapiro.test(results_proteomic_ALS_occurrence$additional_analysis_1$OR_distribution$OR_log)

results_proteomic_ALS_occurrence$additional_analysis_1$boxplot_OR
results_proteomic_ALS_occurrence$additional_analysis_1$densityplot_OR
```

## Additionnal analysis 2

The locally estimated scatterplot smoothing (LOESS) curve illustrates the changes in the ratio of NEFL levels in each case‚Äìcontrol pair/triplet over time. Each point corresponds to 1 case‚Äìcontrol pair/triplet.

```{r}
#| echo: false
#| message: false
#| warning: false
results_proteomic_ALS_occurrence$additional_analysis_2$figure_NEFL_over_time
```

After removing the NEFL outlier

```{r}
#| echo: false
#| message: false
#| warning: false
results_proteomic_ALS_occurrence$additional_analysis_2$figure_NEFL_over_time_sensi_1 
```

## Additionnal analysis 3 
Testing the distribution of the p-values depending on OR>=1 to the distribution of the p-values depending on OR<1 using a Fasano-Franceschini test

The Fasano‚ÄìFranceschini test is a multivariate extension of the Kolmogorov‚ÄìSmirnov test.
While the classical KS test only compares one-dimensional distributions, the Fasano‚ÄìFranceschini test can compare two-dimensional or multidimensional distributions.

It works by evaluating, for every point of one dataset, how the cumulative distribution differs from the other dataset in the four quadrants around that point.
The test statistic D represents the largest difference between the empirical multivariate distributions of the two datasets.
A large value of D indicates that the two datasets occupy different regions of the multidimensional space (e.g., different shapes, locations, or dispersions).

The null hypothesis (H‚ÇÄ) is:
H‚ÇÄ: The two datasets come from the same multivariate distribution.
A small p-value indicates a significant deviation between the two distributions.

### all proteins 
```{r}
#| echo: false
#| message: false
#| warning: false
#| column: screen-inset-right
results_proteomic_ALS_occurrence$additional_analysis_3$additional_analysis_3_all_figure
results_proteomic_ALS_occurrence$additional_analysis_3$additional_analysis_3_all_results

results_proteomic_ALS_occurrence$additional_analysis_3$jackknife_all_results |> 
  select(d_stat_percent) |> 
  mutate(d_stat_percent = round(d_stat_percent, 1)) |>
  tbl_summary()


```

Because the p-value is 0.00587, which is well below the standard 0.05 threshold, we reject the null hypothesis that the two sets of results (OR ‚â• 1 vs. OR < 1) come from the same distribution.

This means that the two groups of proteins, those associated with increased risk and those associated with decreased risk, show significantly different joint distributions of odds ratios and p-values.
Therefore, the asymmetric patterns we observe are unlikely to be due to random fluctuation caused by multiple testing.
The results support the idea that the proteins associated with increased disease risk and those associated with decreased disease risk represent genuinely different biological signals, rather than artifacts of high-dimensional multiple testing.

### Immune response 
```{r}
#| echo: false
#| message: false
#| warning: false
#| column: screen-inset-right
results_proteomic_ALS_occurrence$additional_analysis_3$additional_analysis_3_immune_figure
results_proteomic_ALS_occurrence$additional_analysis_3$additional_analysis_3_immune_results

results_proteomic_ALS_occurrence$additional_analysis_3$jackknife_immune_results |> 
  select(d_stat_percent) |> 
  mutate(d_stat_percent = round(d_stat_percent, 1)) |>
  tbl_summary()
```

### Metbolism
```{r}
#| echo: false
#| message: false
#| warning: false
#| column: screen-inset-right
results_proteomic_ALS_occurrence$additional_analysis_3$additional_analysis_3_metabolism_figure
results_proteomic_ALS_occurrence$additional_analysis_3$additional_analysis_3_metabolism_results

results_proteomic_ALS_occurrence$additional_analysis_3$jackknife_metabolism_results |> 
  select(d_stat_percent) |> 
  mutate(d_stat_percent = round(d_stat_percent, 1)) |>
  tbl_summary()

```


### Neuro explo 
```{r}
#| echo: false
#| message: false
#| warning: false
#| column: screen-inset-right
results_proteomic_ALS_occurrence$additional_analysis_3$additional_analysis_3_neuro_figure
results_proteomic_ALS_occurrence$additional_analysis_3$additional_analysis_3_neuro_results

results_proteomic_ALS_occurrence$additional_analysis_3$jackknife_neuro_results |> 
  select(d_stat_percent) |> 
  mutate(d_stat_percent = round(d_stat_percent, 1)) |>
  tbl_summary()
```


# Proteomic and ALS survival

## Effects of subject characteristics on ALS survival

```{r}
#| echo: false
#| message: false
#| warning: false
results_proteomic_ALS_survival$covar |>
  as_flex_table() |>
  flextable::font(fontname = "Calibri", part = "all") |> 
  fontsize(size = 10, part = "all") |>
  padding(padding.top = 0, padding.bottom = 0, part = "all") |>
  set_table_properties(align = "left")
```

## Cox models

### continuous standardized

```{r, fig.width=9, fig.height=6}
#| echo: false
#| message: false
#| warning: false
results_proteomic_ALS_survival$proteomic_sd_ALS_table |>
  set_table_properties(width = 1, layout = "autofit", align = "left")
results_proteomic_ALS_survival$proteomic_sd_ALS_base_figure
# results_proteomic_ALS_survival$proteomic_sd_ALS_adjusted_figure
```

### quartiles

```{r}
#| echo: false
#| message: false
#| warning: false
#| column: screen-inset-right
results_proteomic_ALS_survival$proteomic_quart_ALS_table  |>
  set_table_properties(width = 1, layout = "autofit", align = "left")
```

### GAMs

```{r fig.height=21, fig.width=9}
#| eval: false
#| message: false
#| warning: false
#| include: false
wrap_plots(results_proteomic_ALS_survival$plot_base_cox_gam_danish, ncol = 5)
wrap_plots(results_proteomic_ALS_survival$plot_adjusted_cox_gam_danish, ncol = 5)
```
